
# Question 3 (Pollinator data)
## Set up notebook
### Install, load packages
```{r message=FALSE, warning=FALSE}
# devtools::install_github("cardiomoon/ggiraphExtra")
# devtools::install_github("dkahle/ggmap")
# devtools::install_github("hadley/devtools")
# install.packages("agricolae")
# install.packages("BH")
# install.packages("car")
# install.packages("cowplot")
# install.packages("digest", type="source")
# install.packages("dplyr")
# install.packages("factoextra")
# install.packages("flextable")
# install.packages("geosphere")
# install.packages("ggiraphExtra")
# install.packages("ggpubr")
# install.packages("ggsn")
# install.packages("ggspatial")
# install.packages("GISTools")
# install.packages("ISLR")
# install.packages("janitor")
# install.packages("lindia")
# install.packages("lme4")
# install.packages("lmerTest")
# install.packages("mnormt")
# install.packages("patchwork")
# install.packages("plogr")
# install.packages("psych")
# install.packages("RcppEigen")
# install.packages("rpart")
# install.packages('sjPlot')
# install.packages('stargazer')
# install.packages("swirl")
# install.packages("tibble")
# install.packages("tidyverse")
# install.packages("vegan")
# install.packages("XLConnect")
# install.packages('backports')
# install.packages(c("slidify", "ggplot2", "devtools"))
# install.packages('maps')
# install.packages('rmarkdown')
# install_github("vqv/ggbiplot")
# library("FactoMineR")
# library("tibble", lib.loc="~/R/win-library/3.5")
# library(agricolae)
# library(apaTables)
library(car) # Companion to Applied Regression
library(data.table) # Extension of `data.frame`
# library(devtools)
# library(DHARMa)
library(dplyr) # A Grammar of Data Manipulation
library(e1071) # Misc Functions of the Department of Statistics, Probability Theory Group (Formerly: E1071), TU Wien
# library(factoextra)
library(flextable) # Functions for Tabular Reporting
library(forcats) # Tools for Working with Categorical Variables (Factors)
library(geosphere) # Spherical Trigonometry
# library(ggbiplot)
library(ggmap) # Spatial Visualization with ggplot2
library(ggpubr) # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots
library(ggsn) # North Symbols and Scale Bars for Maps Created with 'ggplot2' or 'ggmap'
library(ggspatial) # Spatial Data Framework for ggplot2
library(GISTools) # Some further GIS capabilities for R
library(glmmTMB) # Generalized Linear Mixed Models using Template Model Builder
library(gridExtra) # Miscellaneous Functions for "Grid" Graphics
library(here) # A Simpler Way to Find Your Files
library(Hmisc) # Harrell Miscellaneous
# library(hrbrthemes)
# library(ISLR)
# library(janitor)
# library(lindia)
library(lme4) # Linear Mixed-Effects Models using 'Eigen' and S4
library(lmerTest) # Tests in Linear Mixed Effects Models
# library(lsmeans)
library(magrittr)
library(MASS) # Support Functions and Datasets for Venables and Ripley's MASS
library(multcomp) # Simultaneous Inference in General Parametric Models
# library(MuMIn)
library(nlme) # Linear and Nonlinear Mixed Effects Models
library(officer) # Manipulation of Microsoft Word and PowerPoint Documents
library(patchwork) # The Composer of Plots
library(plyr) # Tools for Splitting, Applying and Combining Data
library(reshape) # Flexibly Reshape Data
library(reshape2) # Flexibly Reshape Data: A Reboot of the Reshape Package
library(Rmisc) # Rmisc: Ryan Miscellaneous
library(rpart) # Recursive Partitioning and Regression Trees
library(sjPlot) # Data Visualization for Statistics in Social Science
# library(stargazer)
library(tibble) # Simple Data Frames
library(tidyr) # Tidy Messy Data
library(tidyverse) # Easily Install and Load the 'Tidyverse'
library(vegan) # Community Ecology Package
library(viridis) # Colorblind-Friendly Color Maps for R
require(ggiraph) # Make 'ggplot2' Graphics Interactive
require(ggiraphExtra) # Make Interactive 'ggplot2'. Extension to 'ggplot2' and 'ggiraph'
require(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
# require(MASS)
require(scales) # Scale Functions for Visualization

```

### Import data
```{r}
pollinators <- read.csv(here::here("./raw_data/Pollinator_PivotTable_byPop_Coded.csv"),  header=T, na.strings=c("","NA")) %>%
  dplyr::rename(Patch_ID = 1) %>%
  dplyr::slice(-59) %>% # empty row
  ### Add City_dist values with Haversine formula
  # Ref lat and longs are for Yonge & Dundas intersection in downtown Toronto
  dplyr::mutate(Ref_Lat = 43.656327,
                Ref_Long = -79.380904,
                Lat = as.numeric(Lat),
                Long = as.numeric(Long),
                Patch_ID = as.factor(Patch_ID),
                Transect = as.factor(Transect)) %>%
# Find distances from Yonge/Dundas to sample sites (in meters)
   dplyr::mutate(CTD_m = distHaversine(cbind(Long, Lat),
                               cbind(Ref_Long, Ref_Lat))) %>%
   dplyr::mutate(Dist_city = CTD_m / 1000) %>% # convert to km
# drop ref lat, long, and city_dist (in m) cols
   dplyr::select(-c(Ref_Lat, Ref_Long, CTD_m))


## Import taxonomy table-----
tax <- read.csv(here::here("./raw_data/Taxonomy_transposed.csv"),  header=T, na.strings=c("","NA"), fileEncoding = 'UTF-8-BOM')

# import milkweed site data
long_Transect_Data_18_19 <-
  read.csv(here::here("./clean_data/long_Transect_Data_18_19.csv"),
           header=T,
           na.strings=c("","NA")) %>%
  dplyr::select(-1)

```

## Manipulate pollinator, taxonomy tables
#### All data
```{r}
# Create new table with average pollinator sightings per plant
poll_pp <- pollinators %>%
  as_tibble %>%
  mutate_at(vars(starts_with("MS_")), funs(./pollinators$Plants_surveyed)) %>%
  # Drop inaccurate Total column
  dplyr::select(., -49) %>%
  # add new accurate total col
  rowwise() %>% 
  dplyr::mutate(., Total = sum(c_across(MS_01:MS_42)))
  

# Create new table recoding all sightings to binary (0 = not seen; 1 = seen)
poll_binary <- pollinators[,-49] %>%
  mutate_at(vars(starts_with("MS_")), funs(ifelse(. >0, 1, .))) %>%
  # add new accurate total col
  rowwise() %>% 
  dplyr::mutate(., Total = sum(c_across(MS_01:MS_42)))


# reshape to create diversity table (combining occurrence data with taxonomy)
melted <- melt(poll_pp,
               id = c("Patch_ID", "Lat", "Long", "Dist_city", "Transect", "Plants_surveyed")) %>%
  # remove rows with no pollinators observed, remove "Total"
  filter(value != 0) %>%
  filter(variable != "Total") %>%
  dplyr::rename(Morphospecies_Code = variable, Count = value)

diversity <- merge(x=melted,y=tax,by="Morphospecies_Code",all.x=TRUE) %>%
  # join urbanization scores
  left_join(., long_Transect_Data_18_19 %>%
                    dplyr::select(c(Patch_ID, Urb_score))) %>%
  unique()


 ##################  CALCULATING SPECIES DIVERSITY ##################  
pollinators1 <- poll_pp[,c(1,7:48)]

pollinators1 %<>%
  rowwise() %>% 
  add_column(., shannon = vegan::diversity(pollinators1[-1], index="shannon")) %>%
  add_column(., simpson = vegan::diversity(pollinators1[-1], index="simpson")) %>%
  # remove observations per site to just get site and shannon & simpson indices
  dplyr::select(., c(1,44,45))


# Find number of each taxon level present per population
div_sum <- diversity %>%
  group_by(Patch_ID, Dist_city, Transect, Urb_score) %>%
  dplyr::summarise(
    orders = n_distinct(Order),
    superfams = n_distinct(Superfamily),
    families = n_distinct(Family),
    subfams = n_distinct(Subfamily),
    genera = n_distinct(Genus),
    mspecies = n_distinct(Morphospecies_Code)) %>%
  # Find total number of individuals seen per population & add 
  dplyr::full_join(., diversity %>%
                     group_by(Patch_ID) %>%
                     dplyr::summarise(
                       total_indivs = sum(Count)), by = "Patch_ID") %>%
  # add species richness cols
  ## The mspecies column of div_sum is a simple measure of species richness.
  ## Another measure of species richness, or D (Menhinick's index), = the number of species divided by the square root of the number of individuals in the sample.
  # rowwise() %>% 
  mutate(., Menhinicks_index = mspecies / total_indivs^0.5) %>%

## join all the rows from pollinators1 to div_sum, which doesn't have all sites represented (because those missing sites had no pollinators observed). In this case, those sites had a shannon index of 0 and a simpson's index of 1.
 dplyr::left_join(., pollinators1, by = "Patch_ID")



# get max values in shannon's and simpson's diversity columns
max_shannon <- summarise(div_sum, max(shannon))
max_simpson <- summarise(div_sum, max(simpson))

# add simpson's, shannon's equitabilities to div_sum
div_sum  %<>%
  rowwise() %>%
 # add Shannon's equitability
  dplyr::mutate(., shannon_equit = shannon / max_shannon) %>%
 # add Simpson's equitability
  dplyr::mutate(., simpson_equit = simpson / max_simpson) 

# flatten dfs within df (last 2 cols)
div_sum <- do.call(data.frame, div_sum)
str(div_sum)

names(div_sum)[15] <- "shannon_equit"
names(div_sum)[16] <- "simpson_equit"
# 
# # join urbanization scores
# div_sum <- left_join(div_sum, AvgVars_notNA_Poll_18_19 %>%
#                     dplyr::select(c(Patch_ID, Urb_score)))
# 

 # Find number of each taxon level present per transect
div_transects <- diversity %>%
  group_by(Transect) %>%
  dplyr::summarise(
    Orders = n_distinct(Order),
    Superfamilies = n_distinct(Superfamily),
    Families = n_distinct(Family),
    Subfamilies = n_distinct(Subfamily),
    Genera = n_distinct(Genus),
    Morphospecies = n_distinct(Morphospecies_Code),
    Total_individuals = n())

```
 
#### Without honeybee data
```{r}
# remove honeybee data
diversity_no_honey <- diversity %>% filter(Morphospecies != "Apis mellifera (Large)")

# - - - - -

# Find number of each taxon level present per population
div_sum_no_honey <- diversity_no_honey %>%
  group_by(Patch_ID, Dist_city, Transect, Urb_score) %>%
  dplyr::summarise(
    orders = n_distinct(Order),
    superfams = n_distinct(Superfamily),
    families = n_distinct(Family),
    subfams = n_distinct(Subfamily),
    genera = n_distinct(Genus),
    mspecies = n_distinct(Morphospecies_Code)) %>%
  # Find total number of individuals seen per population & add 
  dplyr::full_join(., diversity_no_honey %>%
                     group_by(Patch_ID) %>%
                     dplyr::summarise(
                       total_indivs = sum(Count)), by = "Patch_ID") %>%
  # add species richness cols
  ## The mspecies column of div_sum is a simple measure of species richness.
  ## Another measure of species richness, or D (Menhinick's index), = the number of species divided by the square root of the number of individuals in the sample.
  # rowwise() %>% 
  mutate(., Menhinicks_index = mspecies / total_indivs^0.5) %>%

## join all the rows from pollinators1 to div_sum, which doesn't have all sites represented (because those missing sites had no pollinators observed). In this case, those sites had a shannon index of 0 and a simpson's index of 1.
 dplyr::left_join(., pollinators1, by = "Patch_ID")



# add simpson's, shannon's equitabilities to div_sum
div_sum_no_honey  %<>%
  rowwise() %>%
 # add Shannon's equitability
  dplyr::mutate(., shannon_equit = shannon / max_shannon) %>%
 # add Simpson's equitability
  dplyr::mutate(., simpson_equit = simpson / max_simpson) 

# flatten dfs within df (last 2 cols)
div_sum_no_honey <- do.call(data.frame, div_sum_no_honey)
str(div_sum_no_honey)

names(div_sum_no_honey)[15] <- "shannon_equit"
names(div_sum_no_honey)[16] <- "simpson_equit"
 

 # Find number of each taxon level present per transect
div_transects_no_honey <- diversity_no_honey %>%
  group_by(Transect) %>%
  dplyr::summarise(
    Orders = n_distinct(Order),
    Superfamilies = n_distinct(Superfamily),
    Families = n_distinct(Family),
    Subfamilies = n_distinct(Subfamily),
    Genera = n_distinct(Genus),
    Morphospecies = n_distinct(Morphospecies_Code),
    Total_individuals = n())

```


#### SummarySE
##### Abundance
```{r}
sum_abun <- summarySE(diversity,
                   measurevar = "Count",
                   groupvars = c("Transect", "Patch_ID", "Dist_city", "Urb_score"),
                   na.rm = T)
```
##### Diversity
```{r}
sum_diversity <- summarySE(div_sum,
                   measurevar = "simpson",
                   groupvars = c("Transect", "Patch_ID", "Dist_city", "Urb_score"),
                   na.rm = T)
```
##### Richness
```{r}
sum_richness <- summarySE(div_sum,
                   measurevar = "Menhinicks_index",
                   groupvars = c("Transect", "Patch_ID", "Dist_city", "Urb_score"),
                   na.rm = T)
```

##### Evenness
```{r}
sum_evenness <- summarySE(div_sum,
                   measurevar = "simpson_equit",
                   groupvars = c("Transect", "Patch_ID", "Dist_city", "Urb_score"),
                   na.rm = T)
```

##### Abundance: No honeybees
```{r}
sum_abun.nohoney <- summarySE(diversity_no_honey,
                   measurevar = "Count",
                   groupvars = c("Transect", "Patch_ID", "Dist_city", "Urb_score"),
                   na.rm = T)
```

##### Diversity: No honeybees
```{r}
sum_diversity.nohoney <- summarySE(div_sum_no_honey,
                   measurevar = "simpson",
                   groupvars = c("Transect", "Patch_ID", "Dist_city", "Urb_score"),
                   na.rm = T)
```
## Statistical Analysis
#### Linear Models
##### Abundance
###### All data
####### City_dist
######## Without transects- NO TRANSFORMATION
```{r}

lm_abun1 <- lm(total_indivs ~ Dist_city,
               data = div_sum)

par(mfrow=c(2,2))
plot(lm_abun1) # looks good

```


######## With transects- NO TRANSFORMATION
```{r}

lm_abun1.urbsubs <- lm(total_indivs ~ Dist_city * Transect,
                       data = div_sum %>%
                         filter(Transect != 'Rural'))

par(mfrow=c(2,2))
plot(lm_abun1.urbsubs)


# I think it looks normal enough, especially because it's not a huge sample size (n = 31 pops)

# main effects model
lm_abun1.urbsubs_ME <- lm(total_indivs ~ Dist_city + Transect,
                       data = div_sum %>%
                         filter(Transect != 'Rural'))
```


####### Urb_score
######## Without transects- NO TRANSFORMATION
```{r}

lm_abun1.u <- lm(total_indivs ~ Urb_score,
               data = div_sum )

par(mfrow=c(2,2))
plot(lm_abun1.u) # looks good

```


######## With transects- NO TRANSFORMATION
```{r}

lm_abun1.urbsubs.u <- lm(total_indivs ~ Urb_score * Transect,
                       data = div_sum %>%
                         filter(Transect != 'Rural'))

par(mfrow=c(2,2))
plot(lm_abun1.urbsubs.u)


# I think it looks normal enough, especially because it's not a huge sample size (n < 35 pops)

# main effects model
lm_abun1.urbsubs.u_ME <- lm(total_indivs ~ Urb_score + Transect,
                       data = div_sum %>%
                         filter(Transect != 'Rural'))
```

###### Without honeybees
####### City_dist
######## Without transects- NO TRANSFORMATION
```{r}

lm_abun1.nohoney <- lm(total_indivs ~ Dist_city,
               data = div_sum_no_honey)

par(mfrow=c(2,2))
plot(lm_abun1.nohoney) # looks good

```


######## With transects- NO TRANSFORMATION
```{r}

lm_abun1.urbsubs.nohoney <- lm(total_indivs ~ Dist_city * Transect,
                       data = div_sum_no_honey %>%
                         filter(Transect != 'Rural'))

par(mfrow=c(2,2))
plot(lm_abun1.urbsubs.nohoney)


# I think it looks normal enough, especially because it's not a huge sample size (n = 31 pops)

# main effects model
lm_abun1.urbsubs.nohoney_ME <- lm(total_indivs ~ Dist_city + Transect,
                       data = div_sum_no_honey %>%
                         filter(Transect != 'Rural'))
```

####### Urb_score
######## Without transects- NO TRANSFORMATION
```{r}

lm_abun1.u_nohoney <- lm(total_indivs ~ Urb_score,
               data = div_sum_no_honey )

par(mfrow=c(2,2))
plot(lm_abun1.u_nohoney) # looks good

```


######## With transects- NO TRANSFORMATION
```{r}

lm_abun1.urbsubs.u_nohoney <- lm(total_indivs ~ Urb_score * Transect,
                       data = div_sum_no_honey %>%
                         filter(Transect != 'Rural'))

par(mfrow=c(2,2))
plot(lm_abun1.urbsubs.u_nohoney)


# I think it looks normal enough

# main effects model
lm_abun1.urbsubs.u_nohoney_ME <- lm(total_indivs ~ Urb_score + Transect,
                       data = div_sum_no_honey %>%
                         filter(Transect != 'Rural'))
```

##### Simpson's Diversity
###### All data
####### City_dist
######## Without transects- squaring TRANSFORMATION
```{r}

lm_diversity <- lm(simpson ~ Dist_city, data = div_sum )

par(mfrow=c(2,2))
plot(lm_diversity)

## Histogram
gg_reshist(lm_diversity, bins=15)

diagnostic(lm_diversity$residuals)
# some left skew

# Try a transformation: 
gg_reshist(lm(simpson^2 ~ Dist_city, data = div_sum ), bins=10 ) # this one looks best.
gg_reshist(lm(simpson^(3) ~ Dist_city, data = div_sum ), bins=10 )
gg_reshist(lm(log(1-simpson) ~ Dist_city, data = div_sum ), bins=10) 


lm_diversity <- lm(simpson^2 ~ Dist_city,
                   data = div_sum )

```


######## With transects- cubing TRANSFORMATION
```{r}

lm_diversity.urbsubs <- lm(simpson ~ Dist_city * Transect,
                           data = div_sum %>%
                         filter(Transect != 'Rural') )

par(mfrow=c(2,2))
plot(lm_diversity.urbsubs)

## Histogram
gg_reshist(lm_diversity.urbsubs, bins=15)

diagnostic(lm_diversity.urbsubs$residuals)
# extreme left skew!

# Conclusion: Try a transformation: 
gg_reshist(lm(simpson^2 ~ Dist_city* Transect, data = div_sum %>%
                         filter(Transect != 'Rural') ), bins=10 ) 
gg_reshist(lm(simpson^(3) ~ Dist_city* Transect, data =div_sum %>%
                         filter(Transect != 'Rural') ), bins=10 ) # looks best
gg_reshist(lm(log(1-simpson) ~ Dist_city* Transect, data = div_sum %>%
                         filter(Transect != 'Rural') ), bins=10) 


lm_diversity.urbsubs <- lm(simpson^3 ~ Dist_city * Transect,
                           data = div_sum %>%
                         filter(Transect != 'Rural') )

# main effects
lm_diversity.urbsubs_ME <- lm(simpson^3 ~ Dist_city + Transect,
                           data = div_sum %>%
                         filter(Transect != 'Rural') )

```
####### Urb_score
######## Without transects- squaring TRANSFORMATION
```{r}

lm_diversity.u <- lm(simpson ~ Urb_score, data = div_sum )

par(mfrow=c(2,2))
plot(lm_diversity.u)

## Histogram
gg_reshist(lm_diversity.u, bins=15)

diagnostic(lm_diversity.u$residuals)
# some left skew

# Try a transformation: 
gg_reshist(lm(simpson^2 ~ Urb_score, data = div_sum ), bins=10 ) # looks good enough
gg_reshist(lm(simpson^(3) ~ Urb_score, data = div_sum ), bins=10 )
gg_reshist(lm(log(1-simpson) ~ Urb_score, data = div_sum ), bins=10) 


lm_diversity.u <- lm(simpson^2 ~ Urb_score,
                   data = div_sum )
```


######## With transects- cubing TRANSFORMATION
```{r}

lm_diversity.urbsubs.u <- lm(simpson ~ Urb_score * Transect,
                           data = div_sum %>%
                         filter(Transect != 'Rural') )

par(mfrow=c(2,2))
plot(lm_diversity.urbsubs.u)

## Histogram
gg_reshist(lm_diversity.urbsubs.u, bins=10)

diagnostic(lm_diversity.urbsubs.u$residuals)
# left skew

# Conclusion: Try a transformation: 
gg_reshist(lm(simpson^2 ~ Urb_score* Transect, data = div_sum %>%
                         filter(Transect != 'Rural') ), bins=10 ) 
plot(lm(simpson^2 ~ Urb_score* Transect, data = div_sum %>%
                         filter(Transect != 'Rural') ))

gg_reshist(lm(simpson^(3) ~ Urb_score* Transect, data =div_sum %>%
                         filter(Transect != 'Rural') ), bins=10 ) 
plot(lm(simpson^3 ~ Urb_score* Transect, data = div_sum %>%
                         filter(Transect != 'Rural') ))# looks best

gg_reshist(lm(log(1-simpson) ~ Urb_score* Transect, data = div_sum %>%
                         filter(Transect != 'Rural') ), bins=10) 


lm_diversity.urbsubs.u <- lm(simpson^3 ~ Urb_score * Transect,
                           data = div_sum %>%
                         filter(Transect != 'Rural') )

# main effects
lm_diversity.urbsubs.u_ME <- lm(simpson^3 ~ Urb_score + Transect,
                           data = div_sum %>%
                         filter(Transect != 'Rural') )

```
###### without honeybees
####### City_dist
######## Without transects- SQUARING TRANSFORMATION
```{r}
lm.diversity_nohoney <- lm(simpson ~ Dist_city,
                           data = div_sum_no_honey )

par(mfrow=c(2,2))
plot(lm.diversity_nohoney)

## Histogram
gg_reshist(lm.diversity_nohoney, bins=10)

diagnostic(lm.diversity_nohoney$residuals)
# some left skew

# Try a transformation: 
gg_reshist(lm(simpson ~ Dist_city, data = div_sum_no_honey ), bins=10 )
gg_reshist(lm(simpson^(2) ~ Dist_city, data = div_sum_no_honey ), bins=10 )
gg_reshist(lm(simpson^(3) ~ Dist_city, data = div_sum_no_honey ), bins=10 )

par(mfrow=c(2,2))
plot(lm(simpson^(2) ~ Dist_city, data = div_sum_no_honey ))
# Looks MUCH better. With only 48 observations, it's a small dataset too.

# Conclusion: use square transformation.


lm.diversity_nohoney <- lm(simpson^2 ~ Dist_city,
                           data = div_sum_no_honey )
```


######## With transects- CUBE TRANSFORMATION
```{r}

lm.diversity_nohoney.urbsubs <- lm(simpson ~ Dist_city * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural'))

par(mfrow=c(2,2))
plot(lm.diversity_nohoney.urbsubs)

## Histogram
gg_reshist(lm.diversity_nohoney.urbsubs, bins=10)

diagnostic(lm.diversity_nohoney.urbsubs$residuals)
# extreme left skew!

# Conclusion: Try a transformation: 
gg_reshist(lm(simpson^2 ~ Dist_city * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural')), bins=10 )
gg_reshist(lm(simpson^3 ~ Dist_city * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural')), bins=10 )
gg_reshist(lm(1 - log(simpson + 1) ~ Dist_city * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural')), bins=10 )
# cube transformation looks very good, especially since this is a small dataset again (31 entries)

lm.diversity_nohoney.urbsubs <- lm(simpson^3 ~ Dist_city * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural'))

# main effects
lm.diversity_nohoney.urbsubs_ME <- lm(simpson^3 ~ Dist_city + Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural'))
```
####### Urb_score
######## Without transects- SQUARING TRANSFORMATION
```{r}
lm.diversity_nohoney.u <- lm(simpson ~ Urb_score,
                           data = div_sum_no_honey )

par(mfrow=c(2,2))
plot(lm.diversity_nohoney.u)

## Histogram
gg_reshist(lm.diversity_nohoney.u, bins=10)

diagnostic(lm.diversity_nohoney.u$residuals)
# some left skew

# Try a transformation: 
gg_reshist(lm(simpson ~ Urb_score, data = div_sum_no_honey ), bins=10 )
gg_reshist(lm(simpson^(2) ~ Urb_score, data = div_sum_no_honey ), bins=10 )
gg_reshist(lm(simpson^(3) ~ Urb_score, data = div_sum_no_honey ), bins=10 )

par(mfrow=c(2,2))
plot(lm(simpson^(2) ~ Urb_score, data = div_sum_no_honey ))
# Looks MUCH better. With only 48 observations, it's a small dataset too.

# Conclusion: use square transformation.


lm.diversity_nohoney.u <- lm(simpson^2 ~ Urb_score,
                           data = div_sum_no_honey )
```


######## With transects- CUBE TRANSFORMATION
```{r}

lm.diversity_nohoney.urbsubs.u <- lm(simpson ~ Urb_score * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural'))

par(mfrow=c(2,2))
plot(lm.diversity_nohoney.urbsubs.u)

## Histogram
gg_reshist(lm.diversity_nohoney.urbsubs.u, bins=10)

diagnostic(lm.diversity_nohoney.urbsubs.u$residuals)
# left skew

# Conclusion: Try a transformation: 
gg_reshist(lm(simpson^2 ~ Urb_score * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural')), bins=10 )
gg_reshist(lm(simpson^3 ~ Urb_score * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural')), bins=10 )
gg_reshist(lm(1 - log(simpson + 1) ~ Urb_score * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural')), bins=10 )
# cube transformation looks very good, especially since this is a small dataset again (31 entries)

lm.diversity_nohoney.urbsubs.u <- lm(simpson^3 ~ Urb_score * Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural'))

# main effects
lm.diversity_nohoney.urbsubs.u_ME <- lm(simpson^3 ~ Urb_score + Transect,
                                   data = div_sum_no_honey %>%
                                     filter(Transect != 'Rural'))
```
##### Species Richness
###### City_dist
####### Without transects- NO TRANSFORMATION NEEDED
```{r}
lm.rich <- lm(Menhinicks_index ~ Dist_city, data = div_sum )

par(mfrow=c(2,2))
plot(lm.rich)

## Histogram
gg_reshist(lm.rich, bins=20)

diagnostic(lm.rich$residuals)
# Very normal!

```

####### With transects- NO TRANSFORMATION NEEDED
```{r}

lm.rich.urbsubs <- lm(Menhinicks_index ~ Dist_city * Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural"))

par(mfrow=c(2,2))
plot(lm.rich.urbsubs)

## Histogram
gg_reshist(lm.rich.urbsubs, bins=15)

diagnostic(lm.rich.urbsubs$residuals)
#  looks fine


lm.rich.urbsubs_ME <- lm(Menhinicks_index ~ Dist_city + Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural"))

```
###### Urb_score
####### Without transects- NO TRANSFORMATION NEEDED
```{r}
lm.rich.u <- lm(Menhinicks_index ~ Urb_score, data = div_sum )

par(mfrow=c(2,2))
plot(lm.rich.u)

## Histogram
gg_reshist(lm.rich.u, bins=15)

diagnostic(lm.rich.u$residuals)
# Very normal!

```

####### With transects- NO TRANSFORMATION NEEDED
```{r}

lm.rich.urbsubs.u <- lm(Menhinicks_index ~ Urb_score * Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural"))

par(mfrow=c(2,2))
plot(lm.rich.urbsubs.u)

## Histogram
gg_reshist(lm.rich.urbsubs.u, bins=10)

diagnostic(lm.rich.urbsubs.u$residuals)
#  looks fine


lm.rich.urbsubs.u_ME <- lm(Menhinicks_index ~ Urb_score + Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural"))

```
##### Evenness (Equitability)
###### City_dist
####### Without transects- NO TRANSFORMATION NEEDED
```{r}
lm.even <- lm(simpson_equit ~ Dist_city,
              data = div_sum )

par(mfrow=c(2,2))
plot(lm.even)

## Histogram
gg_reshist(lm.even, bins=10)

diagnostic(lm.even$residuals)
# Looks pretty normal
```

####### With transects- CUBING TRANSFORMATION 
```{r}
lm.even.urbsubs <- lm(simpson_equit ~ Dist_city * Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural") )

par(mfrow=c(2,2))
plot(lm.even.urbsubs)


## Histogram
gg_reshist(lm.even.urbsubs, bins=10)

diagnostic(lm.even.urbsubs$residuals)
# left skew

# Try a transformation: 
gg_reshist(lm(simpson_equit ~ Dist_city* Transect,
              data = div_sum %>%
                        filter(Transect != "Rural") ),
           bins=10 ) 
gg_reshist(lm(simpson_equit^(2) ~ Dist_city* Transect,
              data = div_sum %>%
                        filter(Transect != "Rural") ),
           bins=10 )
gg_reshist(lm(simpson_equit^(3) ~ Dist_city* Transect,
              data = div_sum %>%
                        filter(Transect != "Rural") ),
           bins=10 )

par(mfrow=c(2,2))
plot(lm(simpson_equit^3 ~ Dist_city * Transect, data = div_sum %>%
                        filter(Transect != "Rural") ))

# Cubing makes it look much better.

lm.even.urbsubs <- lm(simpson_equit^3 ~ Dist_city * Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural") )

# main effects
lm.even.urbsubs_ME <- lm(simpson_equit^3 ~ Dist_city + Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural") )
```

###### Urb_score
####### Without transects- NO TRANSFORMATION NEEDED
```{r}
lm.even.u <- lm(simpson_equit ~ Urb_score,
              data = div_sum )

par(mfrow=c(2,2))
plot(lm.even)

## Histogram
gg_reshist(lm.even.u, bins=10)

diagnostic(lm.even.u$residuals)
# Looks normal enough
```

####### With transects- CUBING TRANSFORMATION
```{r}

lm.even.urbsubs.u <- lm(simpson_equit ~ Urb_score * Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural") )

par(mfrow=c(2,2))
plot(lm.even.urbsubs.u)


## Histogram
gg_reshist(lm.even.urbsubs.u, bins=10) # left skew

# Try a transformation: 
gg_reshist(lm(simpson_equit ~ Urb_score* Transect,
              data = div_sum %>%
                        filter(Transect != "Rural") ),
           bins=10 ) 
gg_reshist(lm(simpson_equit^(2) ~ Urb_score* Transect,
              data = div_sum %>%
                        filter(Transect != "Rural") ),
           bins=10 )
gg_reshist(lm(simpson_equit^(3) ~ Urb_score* Transect,
              data = div_sum %>%
                        filter(Transect != "Rural") ),
           bins=10 )

par(mfrow=c(2,2))
plot(lm(simpson_equit^3 ~ Urb_score * Transect, data = div_sum %>%
                        filter(Transect != "Rural") ))

# Cubing makes it look much better.
lm.even.urbsubs.u <- lm(simpson_equit^3 ~ Urb_score * Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural") )

# main effects
lm.even.urbsubs.u_ME <- lm(simpson_equit^3 ~ Urb_score + Transect,
                      data = div_sum %>%
                        filter(Transect != "Rural") )
```

#### ANOVA
##### Abundance
###### All data
####### City_dist
######## All data
```{r}
car::Anova(lm_abun1) # highly sig
summary(lm_abun1)
```

######## Transects
```{r}
car::Anova(lm_abun1.urbsubs, type = "III") # interaxn not sig
car::Anova(lm_abun1.urbsubs, type = "II") # interaxn not sig
car::Anova(lm_abun1.urbsubs_ME) # not sig

AIC(lm_abun1.urbsubs, lm_abun1.urbsubs_ME) # ME has lower AIC but <2 away
```

####### Urb_score
######## All data
```{r}
car::Anova(lm_abun1.u) # sig
```

######## Transects
```{r}
car::Anova(lm_abun1.urbsubs.u, type = "III") # not sig
car::Anova(lm_abun1.urbsubs.u, type = "II") # not sig
car::Anova(lm_abun1.urbsubs.u_ME) # not sig

AIC(lm_abun1.urbsubs.u, lm_abun1.urbsubs.u_ME) # ME has lower AIC (not <2 away though)
```

####### Find abundance means at urban and rural terminii
```{r}
urban_terminus = 3.5 # km; most urban pop is close to this distance
rural_terminus = 67 # km; most rural pop is close to this distance
midpoint = 35.25 # km; midpoint of urban and rural terminii


coeffs.q.1 = coefficients(lm_abun1)

rural_mean = coeffs.q.1[1] + coeffs.q.1[2]*rural_terminus
rural_mean # mean abundance

urban_mean = coeffs.q.1[1] + coeffs.q.1[2]*urban_terminus
urban_mean # mean abundance

# AVG DIFFERENCE FROM URBAN TO RURAL TERMINUS:
(urban_mean - rural_mean)/(0.5*(urban_mean + rural_mean))

# FIND MEAN abundance
central_mean_q.1 = coeffs.q.1[1] + coeffs.q.1[2]*midpoint
central_mean_q.1




# The percent change formula is as follows:
# (new_value - original_value) / |original_value| * 100

(((urban_mean - rural_mean) / abs(rural_mean)) * 100) # 61% decrease in pollinator abundance from rural to urban terminus
(((rural_mean - urban_mean) / abs(urban_mean)) * 100) # 155% increase in pollinator abundance from urban to rural terminus
```

###### Without honeybees
####### City_dist
######## All data
```{r}
car::Anova(lm_abun1.nohoney) # not sig- stark contrast to dataset WITH honeybees- clear effect of distance

```

######## Transects
```{r}
car::Anova(lm_abun1.urbsubs.nohoney, type = "III") # not sig
car::Anova(lm_abun1.urbsubs.nohoney, type = "II") # not sig
car::Anova(lm_abun1.urbsubs.nohoney_ME) # not sig

AIC(lm_abun1.urbsubs.nohoney, lm_abun1.urbsubs.nohoney_ME) # ME has lower AIC but <2 away
```

####### Urb_score
######## All data
```{r}
car::Anova(lm_abun1.u_nohoney) # not sig- stark contrast to dataset WITH honeybees- clear effect of urb score

```

######## Transects
```{r}
car::Anova(lm_abun1.urbsubs.u_nohoney, type = "III") # nothing sig
car::Anova(lm_abun1.urbsubs.u_nohoney, type = "II") # nothing sig
car::Anova(lm_abun1.urbsubs.u_nohoney_ME) # nothing sig

AIC(lm_abun1.urbsubs.u_nohoney, lm_abun1.urbsubs.u_nohoney_ME) # Full has lower AIC (not <2 away though)
```

##### Diversity
###### Simpson's Diversity Index
####### City_dist
######## All data
######### Gradient
```{r}
car::Anova(lm_diversity)
## Nothing sig

```

######### Transects
```{r}
car::Anova(lm_diversity.urbsubs, type = "III") # transect sig
car::Anova(lm_diversity.urbsubs, type = "II") # transect sig
car::Anova(lm_diversity.urbsubs_ME) # transect sig

AIC(lm_diversity.urbsubs, lm_diversity.urbsubs_ME) # full model has lower AIC but <2 away

summary(lm_diversity.urbsubs) # corridor transect was 0.311 units diversity lower than non-corridor subtransect




## LONG-HAND CALCULATIONS ##
############################

# NON-CORRIDOR coefficient (estimate): 0.408938
# CORRIDOR coefficient (estimate): 0.408938 - 0.31122 = 0.097718
# PERCENT CHANGE from non-corr to corr: (corr - non-corr) / non-corr = (0.097718 - 0.408938)/0.408938 = 76% decrease in diversity in corridor compared to non-corridor


## SHORT-HAND CALCULATIONS ##
#############################

nonC_est <- summary(lm_diversity.urbsubs)$coeff[1] # = non-corridor estimate
summary(lm_diversity.urbsubs)$coeff[3] # = difference btwn corridor and non-corridor
C_est <- (summary(lm_diversity.urbsubs)$coeff[1] + summary(lm_diversity.urbsubs)$coeff[3]) # corridor estimate

# PERCENT CHANGE from non-corr to corr:
(C_est - nonC_est) / nonC_est # 76% decrease in diversity in corridor compared to non-corridor

```

######## Removing honeybees
######### Gradient
```{r}
car::Anova(lm.diversity_nohoney) ## Nothing sig
```

######### Transects
```{r}
car::Anova(lm.diversity_nohoney.urbsubs, type = "III") # transect sig
car::Anova(lm.diversity_nohoney.urbsubs, type = "II") # transect sig
car::Anova(lm.diversity_nohoney.urbsubs_ME) # transect sig

AIC(lm.diversity_nohoney.urbsubs, lm.diversity_nohoney.urbsubs_ME) # ME model has lower AIC but <2 away

summary(lm.diversity_nohoney.urbsubs_ME) # corridor transect was 0.134 units diversity lower than non-corridor subtransect



## SHORT-HAND CALCULATIONS ##
#############################

nonC_est <- summary(lm.diversity_nohoney.urbsubs_ME)$coeff[1] # = non-corridor estimate
summary(lm.diversity_nohoney.urbsubs_ME)$coeff[3] # = difference btwn corridor and non-corridor
C_est <- (summary(lm.diversity_nohoney.urbsubs_ME)$coeff[1] + summary(lm.diversity_nohoney.urbsubs_ME)$coeff[3]) # corridor estimate

# PERCENT CHANGE from non-corr to corr:
(C_est - nonC_est) / nonC_est # 41% decrease in diversity in corridor compared to non-corridor
```

####### Urb_score
######## All data
######### Gradient
```{r}
car::Anova(lm_diversity.u)
## urb_score sig

```

######### Transects
```{r}
car::Anova(lm_diversity.urbsubs.u, type = "III") # transect sig
car::Anova(lm_diversity.urbsubs.u, type = "II") # transect sig
car::Anova(lm_diversity.urbsubs.u_ME) #  transect sig

AIC(lm_diversity.urbsubs.u, lm_diversity.urbsubs.u_ME) # ME has lower AIC (but <2 away)

summary(lm_diversity.urbsubs.u_ME) # corridor transect was 0.119 units diversity lower than non-corridor subtransect
```

######## Removing honeybees
######### Gradient
```{r}
car::Anova(lm.diversity_nohoney.u) ## urb_score sig
```

######### Transects
```{r}
car::Anova(lm.diversity_nohoney.urbsubs.u, type = "III") # transect sig
car::Anova(lm.diversity_nohoney.urbsubs.u, type = "II") # transect sig
car::Anova(lm.diversity_nohoney.urbsubs.u_ME) # transect sig

AIC(lm.diversity_nohoney.urbsubs.u, lm.diversity_nohoney.urbsubs.u_ME) # full model has lower AIC (<2 away)
```

##### Richness
###### City_dist
####### Gradient
```{r}
car::Anova(lm.rich) # sig

```

####### Find richness means at urban and rural terminii
```{r}
urban_terminus = 3.5 # km; most urban pop is close to this distance
rural_terminus = 67 # km; most rural pop is close to this distance
midpoint = 35.25 # km; midpoint of urban and rural terminii


coeffs.q.1 = coefficients(lm.rich)

rural_mean = coeffs.q.1[1] + coeffs.q.1[2]*rural_terminus
rural_mean # mean richness

urban_mean = coeffs.q.1[1] + coeffs.q.1[2]*urban_terminus
urban_mean # mean richness

# AVG DIFFERENCE FROM URBAN TO RURAL TERMINUS:
(urban_mean - rural_mean)/(0.5*(urban_mean + rural_mean))

# FIND MEAN richness
central_mean_q.1 = coeffs.q.1[1] + coeffs.q.1[2]*midpoint
central_mean_q.1


# urban sites had, on average, 0.502 units higher richness than rural!

# The percent change formula is as follows:
# (new_value - original_value) / |original_value| * 100

(((urban_mean - rural_mean) / abs(rural_mean)) * 100) # 63% increase in pollinator richness from rural to urban terminus
(((rural_mean - urban_mean) / abs(urban_mean)) * 100) # 39% decrease in pollinator richness from urban to rural terminus
```

####### Transects
```{r}
car::Anova(lm.rich.urbsubs, type = "III") # transect sig
car::Anova(lm.rich.urbsubs, type = "II") # transect sig
car::Anova(lm.rich.urbsubs_ME) # transect sig

AIC(lm.rich.urbsubs, lm.rich.urbsubs_ME) # ME model lower AIC but <2

summary(lm.rich.urbsubs_ME) # corridor subtransect had 0.6 units lower richness than non-corridor, on avg!


## SHORT-HAND CALCULATIONS ##
#############################

nonC_est <- summary(lm.rich.urbsubs_ME)$coeff[1] # = non-corridor estimate
summary(lm.rich.urbsubs_ME)$coeff[3] # = difference btwn corridor and non-corridor
C_est <- (summary(lm.rich.urbsubs_ME)$coeff[1] + summary(lm.rich.urbsubs_ME)$coeff[3]) # corridor estimate

# PERCENT CHANGE from non-corr to corr:
(C_est - nonC_est) / nonC_est # 21% decrease in richness in corridor compared to non-corridor
```

###### Urb_score
####### Gradient
```{r}
car::Anova(lm.rich.u) # highly sig

```
####### Transects
```{r}
car::Anova(lm.rich.urbsubs.u, type = "III") # transect marg sig
car::Anova(lm.rich.urbsubs.u, type = "II") # transect marg sig
car::Anova(lm.rich.urbsubs.u_ME) # transect marg sig

AIC(lm.rich.urbsubs.u, lm.rich.urbsubs.u_ME) # ME model lower AIC but <2
```

##### Simpson's Evenness (Equitability)
###### City_dist
####### Gradient
```{r}
car::Anova(lm.even) # not sig

```

####### Transects
```{r}
car::Anova(lm.even.urbsubs, type = "III") # transect sig
car::Anova(lm.even.urbsubs, type = "II") # transect sig
car::Anova(lm.even.urbsubs_ME) # transect sig

AIC(lm.even.urbsubs,lm.even.urbsubs_ME ) # full model lower AIC but <2

summary(lm.even.urbsubs) # corridor subtransect had 0.607 units lower evenness than non-corridor, on avg!

```

###### Urb_score
####### Gradient
```{r}
car::Anova(lm.even.u) # not sig

```

####### Transects
```{r}
car::Anova(lm.even.urbsubs.u, type = "III") # transect sig
car::Anova(lm.even.urbsubs.u, type = "II") # transect sig
car::Anova(lm.even.urbsubs.u_ME) # transect sig

AIC(lm.even.urbsubs.u,lm.even.urbsubs.u_ME ) # ME model lower AIC (but <2 away)

```

#### Export ANOVA
###### Functions
```{r}
# tidy anovas
tidy_sb.pollinators_lm <- function(model){
  
  return(
    car::Anova(model) %>%
      broom::tidy() %>%
      dplyr::mutate(Sites = case_when(
        str_detect(as.character(formula(model)[3]), "Transect") == TRUE ~ "Urban Only",
        str_detect(as.character(formula(model)[3]), "Transect") == FALSE ~ "All"),
                    .before = term) %>%
      dplyr::mutate(Significance = case_when(p.value < 0.001 ~ "***",
                                             p.value < 0.01 ~ "**",
                                             p.value <= 0.05 ~ "*")) %>%
      dplyr::mutate(., AIC = as.numeric(AIC(model))) %>%
      mutate_if(is.numeric, round, 3)  %>%
      dplyr::mutate(p.value = replace(p.value, Significance == "***", "<0.001"))  %>%
      dplyr::rename(., 
                    # "F" = statistic,
                    Predictor = term,
                    p = p.value) %>%
      unite("p", p:Significance, sep = "", na.rm = TRUE) %>%
      dplyr::mutate_if(.,
                is.character,
                str_replace_all,
                pattern = c("Dist_city"),
                replacement = c("Distance to City Center")) %>%
        dplyr::mutate_if(.,
                is.character,
                str_replace_all,
                pattern = c("Urb_score"),
                replacement = c("Urbanization Score")) %>%
        dplyr::mutate_if(.,
                is.character,
                str_replace_all,
                pattern = c("Transect"),
                replacement = c("Subtransect")) %>%
        dplyr::mutate_if(.,
                is.character,
                str_replace_all,
                pattern = c(":"),
                replacement = c(" x "))
  )
}


# combine anovas into publication-quality tables
make_Q3_Anova.pollinators <- function(anova_list){
  return(
    lapply(anova_list, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('X2' = 2,
                  'p' = 3,
                  'X2 ' = 4,
                  'p ' = 5) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Simpson's Diversity"),
      colwidths = c(1, 2, 2)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:5, align = "center", part = "body") %>%
    align(j = 2:5, align = "center", part = "header") %>%
      flextable::compose(i = 2, j = c(2,4), part = "header",
        value = as_paragraph("χ", as_sup("2"))) %>%
      flextable::compose(i = 2, j = c(3,5), part = "header",
              value = as_paragraph(as_i("p"))) %>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body")
    )
}

```

###### Main text: Abundance, Diversity, Richness
```{r}
# CITY_DIST-----
## ALL SITES

best_mods_Q3.dist_list <- list(
### abundance
  lm_abun1,  
## richness
lm.rich,
### diversity
lm_diversity
)

lapply(best_mods_Q3.dist_list, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9,
                  'Sum of Squares  ' = 10,
                  'df  ' = 11,
                  'F  ' = 12,
                  'p  ' = 13) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Menhinick's Species Richness",
                 "Simpson's Diversity"),
      colwidths = c(1, 4, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:13, align = "center", part = "body") %>%
    align(j = 2:13, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 1.1) %>%
  width(j = c(2, 6, 10), width = 1) %>%
  width(j = c(4:5, 8:9, 12:13), width = 0.7) %>%
  width(j = c(3,7,11), width = 0.3) %>%
  italic(i = 2, j = 2:13, part = "header") %>%
  # add_footer_lines("Table X: Results from general linear models examining the effects of urbanization on pollinator abundance, diversity, and richness. Urbanization was quantified via distance to city center and all populations were included. Shown are sums of squares, degrees of freedom (df), p-values (p), and F-statistics (F) obtained from type II ANOVA.") %>%
  # add_footer_lines(paste0("AIC, Abundance: ",
  #                         AIC(lm_abun1) %>% round(., 3))) %>%
  # add_footer_lines(paste0("AIC, Diversity: ",
  #                         AIC(lm_diversity) %>% round(., 3))) %>%
  #   add_footer_lines(paste0("AIC, Richness: ",
  #                         AIC(lm.rich) %>% round(., 3))) %>%
  # add_footer_lines("*: p-value <= 0.05") %>%
  # add_footer_lines("**: p-value <= 0.01") %>%
  # add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Q3_Dist_ANOVA.png"))




# CITY_DIST-----
## URBAN SITES

best_mods_Q3urban.dist_list <- list(
### abundance
  lm_abun1.urbsubs_ME,
  ## richness
lm.rich.urbsubs_ME,
### diversity
lm_diversity.urbsubs

)

lapply(best_mods_Q3urban.dist_list, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect",
                                         "Distance to City Center x Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9,
                  'Sum of Squares  ' = 10,
                  'df  ' = 11,
                  'F  ' = 12,
                  'p  ' = 13) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Menhinick's Species Richness",
                 "Simpson's Diversity"),
      colwidths = c(1, 4, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:13, align = "center", part = "body") %>%
    align(j = 2:13, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2) %>%
  width(j = c(2, 6, 10), width = 0.8) %>%
  width(j = c(4:5, 8:9, 12:13), width = 0.7) %>%
  width(j = c(3,7,11), width = 0.3) %>%
  italic(i = 2, j = 2:13, part = "header") %>%
  # add_footer_lines("Table X: Results from general linear models examining the effects of urbanization and distance to an urban corridor on pollinator abundance, diversity, and richness. Urbanization was quantified via distance to city center and only urban populations were included. Shown are sums of squares, degrees of freedom (df), p-values (p), and F-statistics (F) obtained from type II ANOVA.") %>%
  # add_footer_lines(paste0("AIC, Abundance: ",
  #                         AIC(lm_abun1.urbsubs_ME) %>% round(., 3))) %>%
  # add_footer_lines(paste0("AIC, Diversity: ",
  #                         AIC(lm_diversity.urbsubs) %>% round(., 3))) %>%
  #   add_footer_lines(paste0("AIC, Richness: ",
  #                         AIC(lm.rich.urbsubs_ME) %>% round(., 3))) %>%
  # add_footer_lines("*: p-value <= 0.05") %>%
  # add_footer_lines("**: p-value <= 0.01") %>%
  # add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q4_ANOVA/Q3_Dist_urban_ANOVA.png"))


# URB_SCORE-----
## all sites

best_mods_Q3.usc_list <- list(
### abundance
  lm_abun1.u,
  ## richness
lm.rich.u,
### diversity
lm_diversity.u

)

lapply(best_mods_Q3.usc_list, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9,
                  'Sum of Squares  ' = 10,
                  'df  ' = 11,
                  'F  ' = 12,
                  'p  ' = 13) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Menhinick's Species Richness",
                 "Simpson's Diversity"),
      colwidths = c(1, 4, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:13, align = "center", part = "body") %>%
    align(j = 2:13, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2.3) %>%
  width(j = c(2, 6, 10), width = 1) %>%
  width(j = c(4:5, 8:9, 12:13), width = 0.7) %>%
  width(j = c(3,7,10), width = 0.5) %>%
  # italic(i = 2, j = 2:13, part = "header") %>%
  # add_footer_lines("Table X: Results from general linear models examining the effects of urbanization on pollinator abundance, diversity, and richness. Urbanization was quantified via urbanization score and all populations were included. Shown are sums of squares, degrees of freedom (df), p-values (p),  and F-statistics (F) obtained from type II ANOVA.") %>%
  # add_footer_lines(paste0("AIC, Abundance: ",
  #                         AIC(lm_abun1.u) %>% round(., 3))) %>%
  # add_footer_lines(paste0("AIC, Diversity: ",
  #                         AIC(lm_diversity.u) %>% round(., 3))) %>%
  #   add_footer_lines(paste0("AIC, Richness: ",
  #                         AIC(lm.rich.u) %>% round(., 3))) %>%
  # add_footer_lines("*: p-value <= 0.05") %>%
  # add_footer_lines("**: p-value <= 0.01") %>%
  # add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Q3_Usc_ANOVA.png"))



# URB_SCORE-----
## URBAN sites
best_mods_Q3urban.usc_list <- list(
### abundance
  lm_abun1.urbsubs.u_ME,
## richness
lm.rich.urbsubs.u_ME,  
### diversity
lm_diversity.urbsubs.u_ME
)

lapply(best_mods_Q3urban.usc_list, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9,
                  'Sum of Squares  ' = 10,
                  'df  ' = 11,
                  'F  ' = 12,
                  'p  ' = 13) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Menhinick's Species Richness",
                 "Simpson's Diversity"),
      colwidths = c(1, 4, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:13, align = "center", part = "body") %>%
    align(j = 2:13, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 3) %>%
  width(j = c(2, 6, 10), width = 1) %>%
  width(j = c(4:5, 8:9, 12:13), width = 0.7) %>%
  width(j = c(3,7,10), width = 0.5) %>%
  # italic(i = 2, j = 2:13, part = "header") %>%
  # add_footer_lines("Table X: Results from general linear models examining the effects of urbanization and distance to an urban corridor on pollinator abundance, diversity, and richness. Urbanization was quantified via urbanization score and only urban populations were included. Shown are sums of squares, degrees of freedom (df), p-values (p), and F-statistics (F) obtained from type II ANOVA.") %>%
  # add_footer_lines(paste0("AIC, Abundance: ",
  #                         AIC(lm_abun1.urbsubs.u_ME) %>% round(., 3))) %>%
  # add_footer_lines(paste0("AIC, Diversity: ",
  #                         AIC(lm_diversity.urbsubs.u_ME) %>% round(., 3))) %>%
  #   add_footer_lines(paste0("AIC, Richness: ",
  #                         AIC(lm.rich.urbsubs.u_ME) %>% round(., 3))) %>%
  # add_footer_lines("*: p-value <= 0.05") %>%
  # add_footer_lines("**: p-value <= 0.01") %>%
  # add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q4_ANOVA/Q3_Usc_urban_ANOVA.png"))

```

###### Supplement
####### Evenness
```{r}
# CITY_DIST
## all sites-----
lm.even

tidy_sb.pollinators_lm(lm.even) %>%
    as.data.frame() %>%
    # purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Simpson's Evenness"),
      colwidths = c(1, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:5, align = "center", part = "body") %>%
    align(j = 2:5, align = "center", part = "header") %>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2.8) %>%
  width(j = 2, width = 1.2) %>%
  width(j = c(3,4,5), width = 0.2) %>%
  italic(i = 2, j = 2:5, part = "header") %>%
  add_footer_lines("Table X: Results from a general linear model examining the effects of urbanization on pollinator evenness. Urbanization was quantified via distance to city center and all populations were included. Shown are sums of squares, degrees of freedom (df), F-statistics (F), and p-values (p) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Evenness: ",
                          AIC(lm.even) %>% round(., 3))) %>%
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Supplement/Best_models_Evenness/Q3_Dist_evenness_ANOVA.png"))


# CITY_DIST
## URBAN sites-----
lm.even.urbsubs



tidy_sb.pollinators_lm(lm.even.urbsubs) %>%
    as.data.frame() %>%
    # purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Simpson's Evenness"),
      colwidths = c(1, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:5, align = "center", part = "body") %>%
    align(j = 2:5, align = "center", part = "header") %>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 3.9) %>%
  width(j = 2, width = 1.2) %>%
  width(j = c(3,4,5), width = 0.2) %>%
  italic(i = 2, j = 2:5, part = "header") %>%
  add_footer_lines("Table X: Results from a general linear model examining the effects of urbanization and distance to an urban corridor on pollinator evenness. Urbanization was quantified via distance to city center and only urban populations were included. Shown are sums of squares, degrees of freedom (df), F-statistics (F), and p-values (p) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Evenness: ",
                          AIC(lm.even.urbsubs) %>% round(., 3))) %>%
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q4_ANOVA/Supplement/Best_models_Evenness/Q3_Dist_urb_evenness_ANOVA.png"))



# URB_SCORE-----
## all sites-----
lm.even.u



tidy_sb.pollinators_lm(lm.even.u) %>%
    as.data.frame() %>%
    # purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Simpson's Evenness"),
      colwidths = c(1, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:5, align = "center", part = "body") %>%
    align(j = 2:5, align = "center", part = "header") %>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2.5) %>%
  width(j = 2, width = 1.2) %>%
  width(j = c(3,4,5), width = 0.2) %>%
  italic(i = 2, j = 2:5, part = "header") %>%
  add_footer_lines("Table X: Results from a general linear model examining the effects of urbanization on pollinator evenness. Urbanization was quantified via urbanization score and all populations were included. Shown are sums of squares, degrees of freedom (df), F-statistics (F), and p-values (p) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Evenness: ",
                          AIC(lm.even.u) %>% round(., 3))) %>%
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Supplement/Best_models_Evenness/Q3_Urbscore_evenness_ANOVA.png"))



# URB_SCORE
## URBAN sites-----
lm.even.urbsubs.u_ME



tidy_sb.pollinators_lm(lm.even.urbsubs.u_ME) %>%
    as.data.frame() %>%
    # purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Simpson's Evenness"),
      colwidths = c(1, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:5, align = "center", part = "body") %>%
    align(j = 2:5, align = "center", part = "header") %>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 3.7) %>%
  width(j = 2, width = 1.2) %>%
  width(j = c(3,4,5), width = 0.2) %>%
  italic(i = 2, j = 2:5, part = "header") %>%
  add_footer_lines("Table X: Results from a general linear model examining the effects of urbanization and distance to an urban corridor on pollinator evenness. Urbanization was quantified via distance to city center and only urban populations were included. Shown are sums of squares, degrees of freedom (df), F-statistics (F), and p-values (p) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Evenness: ",
                          AIC(lm.even.urbsubs.u_ME) %>% round(., 3))) %>%
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q4_ANOVA/Supplement/Best_models_Evenness/Q3_Urbscore_urb_evenness_ANOVA.png"))
```

####### Abundance & Diversity Models without Honeybees
```{r}
# CITY_DIST-----
## ALL SITES

best_mods_Q3.dist_list_NOHONEY <- list(
### abundance
  lm_abun1.nohoney,  
### diversity
lm.diversity_nohoney
)

lapply(best_mods_Q3.dist_list_NOHONEY, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Simpson's Diversity"),
      colwidths = c(1, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:9, align = "center", part = "body") %>%
    align(j = 2:9, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2.3) %>%
  width(j = c(2, 6), width = 1) %>%
  width(j = c(4:5, 8:9), width = 0.7) %>%
  width(j = c(3,7), width = 0.5) %>%
  italic(i = 2, j = 2:9, part = "header") %>%
  add_footer_lines("Table X: Results from general linear models examining the effects of urbanization on pollinator abundance and diversity using a dataset without honeybees (Apis mellifera). Urbanization was quantified via distance to city center and all populations were included. Shown are sums of squares, degrees of freedom (df), p-values (p), and F-statistics (F) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Abundance: ",
                          AIC(lm_abun1.nohoney) %>% round(., 3))) %>%
  add_footer_lines(paste0("AIC, Diversity: ",
                          AIC(lm.diversity_nohoney) %>% round(., 3))) %>%
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Supplement/Models_without_Honeybees/Q3_Dist_ANOVA_nohoneybees.png"))







# CITY_DIST-----
## URBAN SITES

best_mods_Q3urban.dist_list_NOHONEY <- list(
### abundance
  lm_abun1.urbsubs.nohoney_ME,  
### diversity
lm.diversity_nohoney.urbsubs
)

lapply(best_mods_Q3urban.dist_list_NOHONEY, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect",
                                         "Distance to City Center x Subtransect",
                                         "Residuals"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Simpson's Diversity"),
      colwidths = c(1, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:9, align = "center", part = "body") %>%
    align(j = 2:9, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 3.2) %>%
  width(j = c(2, 6), width = 1) %>%
  width(j = c(4:5, 8:9), width = 0.7) %>%
  width(j = c(3,7), width = 0.5) %>%
  italic(i = 2, j = 2:9, part = "header") %>%
  add_footer_lines("Table X: Results from general linear models examining the effects of urbanization and distance to an urban corridor on pollinator abundance and diversity using a dataset without honeybees (Apis mellifera). Urbanization was quantified via distance to city center and only urban populations were included. Shown are sums of squares, degrees of freedom (df), p-values (p), and F-statistics (F) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Abundance: ",
                          AIC(lm_abun1.urbsubs.nohoney_ME) %>% round(., 3))) %>%
  add_footer_lines(paste0("AIC, Diversity: ",
                          AIC(lm.diversity_nohoney.urbsubs) %>% round(., 3))) %>%
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q4_ANOVA/Supplement/Models_without_Honeybees/Q3_Dist_urban_ANOVA_nohoneybees.png"))


# URB_SCORE-----
## all sites

best_mods_Q3.usc_list_NOHONEY <- list(
### abundance
  lm_abun1.u_nohoney,  
### diversity
lm.diversity_nohoney.u
)

lapply(best_mods_Q3.usc_list_NOHONEY, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Simpson's Diversity"),
      colwidths = c(1, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:9, align = "center", part = "body") %>%
    align(j = 2:9, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2.3) %>%
  width(j = c(2, 6), width = 1) %>%
  width(j = c(4:5, 8:9), width = 0.7) %>%
  width(j = c(3,7), width = 0.5) %>%
  italic(i = 2, j = 2:9, part = "header") %>%
  add_footer_lines("Table X: Results from general linear models examining the effects of urbanization on pollinator abundance and diversity using a dataset without honeybees (Apis mellifera). Urbanization was quantified via urbanization score and all populations were included. Shown are sums of squares, degrees of freedom (df), p-values (p),  and F-statistics (F) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Abundance: ",
                          AIC(lm_abun1.u_nohoney) %>% round(., 3))) %>%
  add_footer_lines(paste0("AIC, Diversity: ",
                          AIC(lm.diversity_nohoney.u) %>% round(., 3))) %>%
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Supplement/Models_without_Honeybees/Q3_Urbscore_ANOVA_nohoneybees.png"))



# URB_SCORE-----
## URBAN sites
best_mods_Q3urban.usc_list_NOHONEY <- list(
### abundance
  lm_abun1.urbsubs.u_nohoney,  
### diversity
lm.diversity_nohoney.urbsubs.u
)

lapply(best_mods_Q3urban.usc_list_NOHONEY, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect"))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", "AIC"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance",
                 "Simpson's Diversity"),
      colwidths = c(1, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:9, align = "center", part = "body") %>%
    align(j = 2:9, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 3) %>%
  width(j = c(2, 6), width = 1) %>%
  width(j = c(4:5, 8:9), width = 0.7) %>%
  width(j = c(3,7), width = 0.5) %>%
  italic(i = 2, j = 2:9, part = "header") %>%
  add_footer_lines("Table X: Results from general linear models examining the effects of urbanization and distance to an urban corridor on pollinator abundance and diversity using a dataset without honeybees (Apis mellifera). Urbanization was quantified via urbanization score and only urban populations were included. Shown are sums of squares, degrees of freedom (df), p-values (p), and F-statistics (F) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Abundance: ",
                          AIC(lm_abun1.urbsubs.u_nohoney) %>% round(., 3))) %>%
  add_footer_lines(paste0("AIC, Diversity: ",
                          AIC(lm.diversity_nohoney.urbsubs.u) %>% round(., 3))) %>%
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q4_ANOVA/Supplement/Models_without_Honeybees/Q3_Urbscore_urban_ANOVA_nohoneybees.png"))

```

####### Alternative (AIC<2 from best) models
######## Abundance/Diversity/Richness
```{r}
## City_dist-----
alt_best_mods_Q3.dist_list <- list(
lm_abun1.urbsubs,
lm_diversity.urbsubs_ME,
lm.rich.urbsubs
)


lapply(alt_best_mods_Q3.dist_list, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect",
                                         "Distance to City Center x Subtransect",
                                         "Urbanization Score x Subtransect",
                                         "Distance to City Center x Year",
                                         "Urbanization Score x Year",
                                         "Year x Subtransect",
                                         "Urbanization Score x Year x Subtransect",
                                         "Distance to City Center x Year x Subtransect"
                                         ))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", 
                                 "AIC", 
                                 "Response"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9,
                  'Sum of Squares  ' = 10,
                  'df  ' = 11,
                  'F  ' = 12,
                  'p  ' = 13) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance, Alt. Model 1",
                 "Simpson's Diversity, Alt. Model 1",
                 "Richness, Alt. Model 1"),
      colwidths = c(1, 4, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:13, align = "center", part = "body") %>%
    align(j = 2:13, align = "center", part = "header")%>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2.3) %>%
  width(j = c(2, 6, 10), width = 1) %>%
  width(j = c(4:5, 8:9, 12:13), width = 0.7) %>%
  width(j = c(3,7,10), width = 0.5) %>%
  italic(i = 2, j = 2:13, part = "header") %>%
  add_footer_lines("Table X: Results from alternative general linear models within 2 AIC from the best model examining the effects of urbanization and proximity to an urban corridor on pollinator abundance, diversity, and richness. Urbanization was quantified via distance to city center and only urban populations were included. Shown are sums of squares, degrees of freedom (df), F-statistics (F), and p-values (p) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Abundance, Alt. Model 1: ",
                          AIC(lm_abun1.urbsubs) %>% round(., 3))) %>%  add_footer_lines(paste0("AIC, Simpson's Diversity, Alt. Model 1: ",
                          AIC(lm_diversity.urbsubs_ME) %>% round(., 3))) %>%  add_footer_lines(paste0("AIC, Richness, Alt. Model 1: ",
                          AIC(lm.rich.urbsubs) %>% round(., 3))) %>%  
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Supplement/Alternative_Models/Q3_Dist_ANOVA_altmodels.png"))




## Urb_score-----
alt_best_mods_Q3.urbsc_list <- list(
lm_abun1.urbsubs.u,
lm_diversity.urbsubs.u,
lm.rich.urbsubs.u
)

lapply(alt_best_mods_Q3.urbsc_list, tidy_sb.pollinators_lm) %>%
    lapply(., as.data.frame) %>%
    purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect",
                                         "Distance to City Center x Subtransect",
                                         "Urbanization Score x Subtransect",
                                         "Distance to City Center x Year",
                                         "Urbanization Score x Year",
                                         "Year x Subtransect",
                                         "Urbanization Score x Year x Subtransect",
                                         "Distance to City Center x Year x Subtransect"
                                         ))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", 
                                 "AIC", 
                                 "Response"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5,
                  'Sum of Squares ' = 6,
                  'df ' = 7,
                  'F ' = 8,
                  'p ' = 9,
                  'Sum of Squares  ' = 10,
                  'df  ' = 11,
                  'F  ' = 12,
                  'p  ' = 13) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Abundance, Alt. Model 1",
                 "Simpson's Diversity, Alt. Model 1",
                 "Richness, Alt. Model 1"),
      colwidths = c(1, 4, 4, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:13, align = "center", part = "body") %>%
    align(j = 2:13, align = "center", part = "header") %>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 3) %>%
  width(j = 2:13, width = 0.7) %>%
  italic(i = 2, j = 2:13, part = "header") %>%
  add_footer_lines("Table X: Results from alternative general linear models within 2 AIC from the best model examining the effects of urbanization and proximity to an urban corridor on pollinator abundance, diversity, and richness. Alternative models of pollinator diversity were >2 AIC of the best models and are not shown. Urbanization was quantified via urbanization score and only urban populations were included. Shown are sums of squares, degrees of freedom (df), F-statistics (F), and p-values (p) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Abundance, Alt. Model 1: ",
                          AIC(lm_abun1.urbsubs.u_ME) %>% round(., 3))) %>%  
    add_footer_lines(paste0("AIC, Simpson's Diversity, Alt. Model 1: ",
                          AIC(lm_diversity.urbsubs.u) %>% round(., 3))) %>%      add_footer_lines(paste0("AIC, Richness, Alt. Model 1: ",
                          AIC(lm.rich.urbsubs.u_ME) %>% round(., 3))) %>%  
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Supplement/Alternative_Models/Q3_Urbscore_ANOVA_altmodels.png"))
```

######## Evenness
```{r}
## City_dist-----
lm.even.urbsubs_ME

lm.even.urbsubs_ME %>%
  tidy_sb.pollinators_lm %>%
    as.data.frame() %>%
    # purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect",
                                         "Distance to City Center x Subtransect",
                                         "Urbanization Score x Subtransect",
                                         "Distance to City Center x Year",
                                         "Urbanization Score x Year",
                                         "Year x Subtransect",
                                         "Urbanization Score x Year x Subtransect",
                                         "Distance to City Center x Year x Subtransect"
                                         ))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", 
                                 "AIC", 
                                 "Response"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Evenness, Alt. Model 1"),
      colwidths = c(1, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:5, align = "center", part = "body") %>%
    align(j = 2:5, align = "center", part = "header") %>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2) %>%
  width(j = 2:5, width = 0.7) %>%
  italic(i = 2, j = 2:5, part = "header") %>%
  add_footer_lines("Table X: Results from an alternative general linear mixed model within 2 AIC from the best model examining the effects of urbanization and proximity to an urban corridor on pollinator evenness Urbanization was quantified via distance to city center and only urban populations were included. Shown are sums of squares, degrees of freedom (df), F-statistics (F), and p-values (p) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Evenness, Alt. Model 1: ",
                          AIC(lm.even.urbsubs_ME) %>% round(., 3))) %>%  
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Supplement/Alternative_Models/Alt_models_evenness/Q3_Dist_ANOVA_altmodels_evenness_citydist.png"))



## Urb_score-----
lm.even.urbsubs.u

lm.even.urbsubs.u %>%
  tidy_sb.pollinators_lm %>%
    as.data.frame() %>%
    # purrr::reduce(full_join, by = "Predictor") %>%
    arrange(factor(Predictor, levels = c("Distance to City Center",
                                         "Urbanization Score",
                                         "Year",
                                         "Subtransect",
                                         "Distance to City Center x Subtransect",
                                         "Urbanization Score x Subtransect",
                                         "Distance to City Center x Year",
                                         "Urbanization Score x Year",
                                         "Year x Subtransect",
                                         "Urbanization Score x Year x Subtransect",
                                         "Distance to City Center x Year x Subtransect"
                                         ))) %>%
    dplyr::select(-starts_with(c("Sites", "Significance", 
                                 "AIC", 
                                 "Response"))) %>%
    replace(., is.na(.), "-") %>%
    dplyr::rename('Sum of Squares' = 2,
                  'df' = 3,
                  'F' = 4,
                  'p' = 5) %>%
    flextable::flextable() %>%
    add_header_row(
      values = c(" ",
                 "Evenness, Alt. Model 1"),
      colwidths = c(1, 4)) %>%
    align(j = 1, align = "left", part = "all") %>%
    align(j = 2:5, align = "center", part = "body") %>%
    align(j = 2:5, align = "center", part = "header") %>%
      fontsize(size = 12, part = "header") %>%
      fontsize(size = 12, part = "body") %>%
  width(j = 1, width = 2.8) %>%
  width(j = 2:5, width = 0.7) %>%
  italic(i = 2, j = 2:5, part = "header") %>%
  add_footer_lines("Table X: Results from an alternative general linear mixed model within 2 AIC from the best model examining the effects of urbanization and proximity to an urban corridor on pollinator evenness Urbanization was quantified via urbanization score and only urban populations were included. Shown are sums of squares, degrees of freedom (df), F-statistics (F), and p-values (p) obtained from type II ANOVA.") %>%
  add_footer_lines(paste0("AIC, Evenness, Alt. Model 1: ",
                          AIC(lm.even.urbsubs.u) %>% round(., 3))) %>%  
  add_footer_lines("*: p-value <= 0.05") %>%
  add_footer_lines("**: p-value <= 0.01") %>%
  add_footer_lines("***: p-value <= 0.001") %>%
  save_as_image(., path = here::here("./Figures_Tables/Q3_ANOVA/Supplement/Alternative_Models/Alt_models_evenness/Q3_Dist_ANOVA_altmodels_evenness_urbscore.png"))
```

##### Creating table with AIC scores
###### Question 3
```{r}

# FOR QUESTION 4:
## Dist, urb score: best_mods_Q3urban.dist_list; best_mods_Q3urban.usc_list
## Evenness: lm.even.urbsubs; lm.even.urbsubs.u_ME
## Alt models: alt_best_mods_Q3.dist_list; alt_best_mods_Q3.urbsc_list
## Alt models: Evenness- lm.even.urbsubs_ME; lm.even.urbsubs.u

# Lists of models

# BEST MODELS
## Q3/Dist: best_mods_Q3.dist_list
### Evenness: lm.even

## Q3/Urb score: best_mods_Q3.usc_list
### Evenness: lm.even.u



AIC_df.Q3 <- data.frame(matrix(nrow = 8,
                            ncol = 5)) #6))

colnames(AIC_df.Q3) <- c("Model", "Urbanization_Metric", "Best_or_Alt_Model", "Variable", "AIC"
                         #, "Delta_AIC_from_Best_Model"
                         )
AIC_df.Q3$Model <- seq.int(nrow(AIC_df.Q3))
AIC_df.Q3[c(1:4),  2] <- "Distance to Urban Center"
AIC_df.Q3[c(5:8), 2] <- "Urbanization Score"
AIC_df.Q3[1:8,  3] <- "Best Model"
# AIC_df.Q3[11:14, 3] <- "Alternative Model"
# AIC_df.Q3 %<>%
#   mutate(Delta_AIC_from_Best_Model = case_when(
#     Best_or_Alt_Model == "Best Model" ~ "-"))

# Q3/Dist- BEST- main vars
for (i in 1:length(best_mods_Q3.dist_list)){
  AIC_df.Q3[i, 4] <- as.character(formula(best_mods_Q3.dist_list[[i]])[2])
  AIC_df.Q3[i, 5] <- as.double(AIC(best_mods_Q3.dist_list[[i]])) %>%
    round(., 3)
}
# Q3/Dist- BEST- evenness
AIC_df.Q3[4, 4] <- as.character(formula(lm.even)[2])
AIC_df.Q3[4, 5] <- as.double(AIC(lm.even)) %>%
  round(., 3)



# Q3/Urb score- BEST- main vars
for (i in 1:length(best_mods_Q3.usc_list)){
  AIC_df.Q3[(i + 4), 4] <- as.character(formula(best_mods_Q3.usc_list[[i]])[2])
  AIC_df.Q3[(i + 4), 5] <- as.double(AIC(best_mods_Q3.usc_list[[i]])) %>%
    round(., 3)
}

# Q3/Urb score- BEST- evenness
AIC_df.Q3[8, 4] <- as.character(formula(lm.even.u)[2])
AIC_df.Q3[8, 5] <- as.double(AIC(lm.even.u)) %>%
  round(., 3)

# ----
# 
# # Q3/Dist- ALTERNATIVE- main vars
# AIC_df.Q3[11, 4] <- as.character(formula(podsperped_lmer_gradient_01)[2])
# AIC_df.Q3[11, 5] <- as.double(AIC(podsperped_lmer_gradient_01)) %>%
#   round(., 3)
# ## now calculate Delta AIC
# AIC_df.Q3[11, 6] <- as.numeric(AIC_df.Q3[11, 5] - AIC_df.Q3[4, 5]) %>% 
#   round(3)
# 
# # Q3/Dist- ALTERNATIVE- height
# AIC_df.Q3[12, 4] <- as.character(formula(height_lmer_gradient_01)[2])
# AIC_df.Q3[12, 5] <- as.double(AIC(height_lmer_gradient_01)) %>%
#   round(., 3)
# ## now calculate Delta AIC
# AIC_df.Q3[12, 6] <- as.numeric(AIC_df.Q3[12, 5] - AIC_df.Q3[5, 5]) %>% 
#   round(3)
# 
# 
# 
# 
# # Q3/Urb score- ALTERNATIVE- main vars
# AIC_df.Q3[13, 4] <- as.character(formula(u_podsperped_lmer_gradient_01)[2])
# AIC_df.Q3[13, 5] <- as.double(AIC(u_podsperped_lmer_gradient_01)) %>%
#     round(., 3)
# ## now calculate Delta AIC
# AIC_df.Q3[13, 6] <- as.numeric(AIC_df.Q3[13, 5] - AIC_df.Q3[9, 5]) %>% 
#   round(3)
# 
# # Q3/Urb score- ALTERNATIVE- height
# AIC_df.Q3[14, 4] <- as.character(formula(u_height_lmer_gradient_02)[2])
# AIC_df.Q3[14, 5] <- as.double(AIC(u_height_lmer_gradient_02)) %>%
#   round(., 3)
# ## now calculate Delta AIC
# AIC_df.Q3[14, 6] <- as.numeric(AIC_df.Q3[14, 5] - AIC_df.Q3[10, 5]) %>% 
#   round(3)



# Now make variable names nice
AIC_df.Q3 %<>%
  mutate(Variable = case_when(
    str_detect(Variable, "total") ~ "Abundance",
    str_detect(Variable, "2")  ~ "Simpson's Diversity",
    str_detect(Variable, "index") ~ "Species Richness",
    str_detect(Variable, "equit")  ~ "Evenness"
    )
  )


write.table(AIC_df.Q3, file = here::here("./Figures_Tables/AIC_df_Q3.txt"), sep = ",", quote = FALSE, row.names = F)

```


###### Question 4
```{r}

# Lists of models

# BEST MODELS
## Q4/Dist: best_mods_Q3urban.dist_list
### Evenness: lm.even.urbsubs

## Q4/Urb score: best_mods_Q3urban.usc_list
### Evenness: lm.even.urbsubs.u_ME


# ALTERNATIVE MODELS
## Q4/Dist: alt_best_mods_Q3.dist_list
### Evenness: lm.even.urbsubs_ME

## Q4/Urb score: alt_best_mods_Q3.urbsc_list
### Evenness: lm.even.urbsubs.u


AIC_df.Q4 <- data.frame(matrix(nrow = 16,
                            ncol = 6))

colnames(AIC_df.Q4) <- c("Model", "Urbanization_Metric", "Best_or_Alt_Model", "Variable", "AIC", "Delta_AIC_from_Best_Model" )
AIC_df.Q4$Model <- seq.int(nrow(AIC_df.Q4))
AIC_df.Q4[c(1:4, 9:12),  2] <- "Distance to Urban Center"
AIC_df.Q4[c(5:8, 13:16), 2] <- "Urbanization Score"
AIC_df.Q4[1:8,  3] <- "Best Model"
AIC_df.Q4[9:16, 3] <- "Alternative Model"
AIC_df.Q4 %<>%
  mutate(Delta_AIC_from_Best_Model = case_when(
    Best_or_Alt_Model == "Best Model" ~ "-"))

# Q4/Dist- BEST- main vars
for (i in 1:length(best_mods_Q3urban.dist_list)){
  AIC_df.Q4[i, 4] <- as.character(formula(best_mods_Q3urban.dist_list[[i]])[2])
  AIC_df.Q4[i, 5] <- as.double(AIC(best_mods_Q3urban.dist_list[[i]])) %>%
    round(., 3)
}
# Q4/Dist- BEST- evenness
AIC_df.Q4[4, 4] <- as.character(formula(lm.even.urbsubs)[2])
AIC_df.Q4[4, 5] <- as.double(AIC(lm.even.urbsubs)) %>%
  round(., 3)



# Q4/Urb score- BEST- main vars
for (i in 1:length(best_mods_Q3urban.usc_list)){
  AIC_df.Q4[(i + 4), 4] <- as.character(formula(best_mods_Q3urban.usc_list[[i]])[2])
  AIC_df.Q4[(i + 4), 5] <- as.double(AIC(best_mods_Q3urban.usc_list[[i]])) %>%
    round(., 3)
}

# Q4/Urb score- BEST- evenness
AIC_df.Q4[8, 4] <- as.character(formula(lm.even.urbsubs.u_ME)[2])
AIC_df.Q4[8, 5] <- as.double(AIC(lm.even.urbsubs.u_ME)) %>%
  round(., 3)

# ----

# Q4/Dist- ALTERNATIVE- main vars
for (i in 1:length(alt_best_mods_Q3.dist_list)){
  AIC_df.Q4[(i + 8), 4] <- as.character(formula(alt_best_mods_Q3.dist_list[[i]])[2])
  AIC_df.Q4[(i + 8), 5] <- as.double(AIC(alt_best_mods_Q3.dist_list[[i]])) %>%
    round(., 3)
}
## now calculate Delta AIC
AIC_df.Q4[9, 6] <- as.numeric(AIC_df.Q4[9, 5] - AIC_df.Q4[1, 5]) %>%
  round(3)
AIC_df.Q4[10, 6] <- as.numeric(AIC_df.Q4[10, 5] - AIC_df.Q4[2, 5]) %>%
  round(3)
AIC_df.Q4[11, 6] <- as.numeric(AIC_df.Q4[11, 5] - AIC_df.Q4[3, 5]) %>%
  round(3)

# Q4/Dist- ALTERNATIVE- evenness
AIC_df.Q4[12, 4] <- as.character(formula(lm.even.urbsubs_ME)[2])
AIC_df.Q4[12, 5] <- as.double(AIC(lm.even.urbsubs_ME)) %>%
  round(., 3)
## now calculate Delta AIC
AIC_df.Q4[12, 6] <- as.numeric(AIC_df.Q4[12, 5] - AIC_df.Q4[4, 5]) %>%
  round(3)



# Q4/Urb score- ALTERNATIVE- main vars
for (i in 1:length(alt_best_mods_Q3.urbsc_list)){
  AIC_df.Q4[(i + 12), 4] <- as.character(formula(alt_best_mods_Q3.urbsc_list[[i]])[2])
  AIC_df.Q4[(i + 12), 5] <- as.double(AIC(alt_best_mods_Q3.urbsc_list[[i]])) %>%
    round(., 3)
}
## now calculate Delta AIC
AIC_df.Q4[13, 6] <- as.numeric(AIC_df.Q4[13, 5] - AIC_df.Q4[5, 5]) %>%
  round(3)
AIC_df.Q4[14, 6] <- as.numeric(AIC_df.Q4[14, 5] - AIC_df.Q4[6, 5]) %>%
  round(3)
AIC_df.Q4[15, 6] <- as.numeric(AIC_df.Q4[15, 5] - AIC_df.Q4[7, 5]) %>%
  round(3)

# Q4/Urb score- ALTERNATIVE- evenness
AIC_df.Q4[16, 4] <- as.character(formula(lm.even.urbsubs.u)[2])
AIC_df.Q4[16, 5] <- as.double(AIC(lm.even.urbsubs.u)) %>%
  round(., 3)
## now calculate Delta AIC
AIC_df.Q4[16, 6] <- as.numeric(AIC_df.Q4[16, 5] - AIC_df.Q4[8, 5]) %>%
  round(3)



# Now make variable names nice
AIC_df.Q4 %<>%
  mutate(Variable = case_when(
    str_detect(Variable, "total") ~ "Abundance",
    str_detect(Variable, "equit")  ~ "Evenness",
    str_detect(Variable, "simpson")  ~ "Simpson's Diversity",
    str_detect(Variable, "index") ~ "Species Richness"
    )
  )


write.table(AIC_df.Q4, file = here::here("./Figures_Tables/AIC_df_Q4.txt"), sep = ",", quote = FALSE, row.names = F)

```



## Tables
```{r}
# ALL POPULATIONS-----
# Total pollinators observed per morphospecies:
Morphospecies_table <- colSums(pollinators[,c(7:48)]) %>%
  as.data.frame() %>%
  tibble::rownames_to_column("Morphospecies_Code") %>%
  dplyr::rename(Individuals_observed = 2) %>%
  full_join(., diversity %>%
              dplyr::select(c(1,14)),
            by = "Morphospecies_Code") %>%
  dplyr::distinct() %T>%
  write.csv(here::here("./Figures_Tables/Q3_Regressions_Pollinators/Q3_Pollinators_Table.csv"))

Morphospecies_table %>%
  dplyr::arrange(desc(Individuals_observed),
                 ) %>%
  dplyr::slice(1:5) %>%
  view() # top 5 most popular morphospecies

Morphospecies_table %>%
dplyr::summarise(sum = sum(Individuals_observed)) # total number of pollinators observed = 307

# ONLY URBAN POPULATIONS-----
# Total pollinators observed per morphospecies:
urb_pollinators <- pollinators %>%
  dplyr::filter(Transect != "Rural") 

Morphospecies_table_urb <- colSums(urb_pollinators[,c(7:48)]) %>%
  as.data.frame() %>%
  tibble::rownames_to_column("Morphospecies_Code") %>%
  dplyr::rename(Individuals_observed = 2) %>%
  left_join(., diversity %>%
              dplyr::select(c(1,14)),
            by = "Morphospecies_Code") %>%
  dplyr::distinct() %T>%
  write.csv(here::here("./Figures_Tables/Q4_Regressions_Pollinators/Q4_Pollinators_Table.csv"))

Morphospecies_table_urb %>%
  dplyr::arrange(desc(Individuals_observed),
                 ) %>%
  dplyr::slice(1:5) %>%
  view() # top 5 most popular morphospecies

Morphospecies_table_urb %>%
dplyr::summarise(sum = sum(Individuals_observed)) # total number of pollinators observed = 158

Morphospecies_table_urb %>%
  dplyr::filter(Individuals_observed >0) %>%
  dim() # total number of morphospecies observed = 36


####### Table of each family's most common morphospecies vs dist city ctr ------
four_popfams <- dplyr::filter(diversity,
                              Family %in%
                                c( 'Apidae',
                                   'Cantharidae' ,
                                   'Halictidae',
                                   'Megachilidae')) %>%
  group_by(Morphospecies, Family) %>%
  dplyr::summarise(
    "Sites" = n_distinct(Patch_ID),
    "Individuals_observed" = sum(Count))

# switch order of first 2 cols
four_popfams <- four_popfams[,c(2,1,3,4)] %T>%
  write.csv(here::here("./Figures_Tables/Q3_Regressions_Pollinators/Q3_4MostCommonMorphospecies_Table.csv")) 

# break into 4 separate tables, calculate subtotals
four_popfams_summary <- four_popfams %>%
  group_by(Family) %>%
  dplyr::summarise(across(Individuals_observed, sum)) %>%
  arrange(desc(Individuals_observed)) %T>%
  write.csv(here::here("./Figures_Tables/Q3_Regressions_Pollinators/Q3_4MostCommonMorphospecies_SummaryTable.csv")) 

# apidae <- dplyr::filter(four_popfams, Family %in% 'Apidae') %>%
#   adorn_totals("row") %T>%
#   view()
# 
# canth <- dplyr::filter(four_popfams, Family %in% 'Cantharidae')%>%
#   adorn_totals("row")
# 
# halict <- dplyr::filter(four_popfams, Family %in% 'Halictidae')%>%
#   adorn_totals("row")
# 
# megachil <- dplyr::filter(four_popfams, Family %in% 'Megachilidae')%>%
#   adorn_totals("row")
# 
# b <- bind_rows(list(apidae, canth, halict, megachil)) %>%
#               arrange(Family, Morphospecies, Sites, Individuals_observed)

# d <- rbindlist(
#   list(
#     four_popfams %>%
#       dplyr::group_by(Family) %>%
#       summarise(across(Sites:Individuals_observed, ~ sum()))
#       summarise(across(sum(Sites),
#                 sum(Individuals_observed))),
#   four_popfams %>%
#     group_by(Family, Morphospecies) %>%
#     summarise(sum(Sites),
#               sum(Individuals_observed))),
#   fill=TRUE) %>%
#   arrange(Family, Morphospecies)
# 
# # Make Total rows clear
# d$Family <- as.character(d$Family)
# d[8,1] <- as.character("Apidae: Total")
# d[10,1] <- as.character("Cantharidae: Total")
# d[18,1] <- as.character("Halictidae: Total")
# d[29,1] <- as.character("Megachilidae: Total")
# 
# colnames(d)[2] <- "Sites Observed"
# colnames(d)[3] <- "Individuals Observed"
# colnames(d)[4] <- "Morphospecies Description "
# 
# kable(d, digits = 3, format = "pandoc", caption = "Top 4 Families") # the digits argument controls rounding
# d_export <- kable(d, digits = 3, format = "pandoc", caption = "Top 4 Families")
# kable(d, "html") %>%
#   kable_styling("striped") %>%
#   save_kable(file = "table_d.html", self_contained = T)
#   as_image(width = 4)
```

## Figures
#### Abundance
##### Gradient
###### City_dist
####### Include points, no stats (not included in paper)
```{r}
# abun <- ggplot(sum_abun,
#                aes(x = Dist_city,
#                    y = Count)) +
#   geom_pointrange(aes(ymin = Count - se, 
#                       ymax = Count + se),
#                   size = 0.5,
#                    color = "black"
#                   # ,
#                   # position = position_jitterdodge(dodge.width = .5)
#                                                   ) +
#     scale_shape(solid = F)+
#   geom_smooth(method = lm,
#               se = F,
#               size = 1,
#               alpha = 0.15,
#               color = "black") +
#   labs( x = " ",
#     # x = "Distance to Urban Center (km)",
#        y = "Mean Pollinators Observed per Plant") +
#   xlim(0,70) +
#   ylim(0, 6) +
#   theme_bw() +
#   # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
#   theme(
#     legend.position = c(.99, .99),
#     legend.justification = c("right", "top"),
#     axis.title.x = element_blank(),
#     legend.box = 'horizontal',
#     legend.box.just = "right",
#     legend.margin = margin(5,5,5,5),
#     text = element_text(size=12),
#     axis.text = element_text(size=12),
#     panel.background = element_blank(),
#     axis.line = element_line(colour = "black"),
#     legend.key = element_rect(fill = NA)
#     ) 
# # +
# #   labs(caption = "Error bars represent standard error")
# abun
```

####### Include points, ADD stats (as in paper)
```{r}
abun <- ggplot(sum_abun,
               aes(x = Dist_city,
                   y = Count)) +
  geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.15,
              color = "#00BFC4",
              fill = "#00BFC4")  +
  xlim(0,70) +
  geom_point(
             size = 2,
             color = "#00BFC4",
             shape = 1) +
  scale_y_continuous(limits = c(0, NA)) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    axis.title.x = element_blank(),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  labs( x = " ",
    # x = "Distance to Urban Center (km)",
       y = "Mean Pollinators per Plant") +
  # adding stats from ANOVA
          geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Distance: p = 0.01"),
                size = 4)
# geom_text(size = 4.25, x=10, y=0.08, label = "Distance: p = 0.01", hjust = 0) 
abun
```


###### Urb_score
####### Include points, no stats (not included in paper)
```{r}
abun.u <- ggplot(sum_abun,
               aes(x = Urb_score,
                   y = Count)) +
  geom_pointrange(aes(ymin = Count - se, 
                      ymax = Count + se),
                  size = 0.5,
                   color = "black"
                  # ,
                  # position = position_jitterdodge(dodge.width = .5)
                                                  ) +
    scale_shape(solid = F)+
  geom_smooth(method = lm,
              se = F,
              size = 1,
              alpha = 0.15,
              color = "black") +
  labs(x = "Urbanization Score",
       y = "Mean Pollinators \n Observed per Plant") +
  xlim(4, -4) +
  ylim(0, 6) +
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme_bw() + 
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    )
# +
#   labs(caption = "Error bars represent standard error")
abun.u
```

####### Include points, ADD stats (as in paper)
```{r}
abun.u <- ggplot(sum_abun,
               aes(x = Urb_score,
                   y = Count)) +
 geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.15,
              color = "#00BFC4",
              fill = "#00BFC4")  +
   geom_point(
             size = 2,
             color = "#00BFC4",
             shape = 1) +
  xlim(4, -4) +
  scale_y_continuous(limits = c(0, NA)) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    # axis.title.x = element_blank(),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  labs(x = "Urbanization Score",
       y = "Mean Pollinators per Plant") +
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Urb. Score: p = 0.016"),
                size = 4)

abun.u
```


##### Transects
###### City_dist
####### Include points, no stats (not included in paper)
```{r}
# abun_transect <- ggplot(sum_abun %>%
#                           filter(Transect != "Rural"),
#                         aes(x = Dist_city,
#                             y = Count,
#                             color = Transect,
#                             shape = Transect,
#                             fill = Transect,
#                             linetype = Transect)) +
#   labs(x = " ",
#     # x = "Distance to Urban Center (km)",
#        y = "Mean Pollinators Observed per Plant",
#        shape = "Subtransect",
#        linetype = "Subtransect",
#        color = "Subtransect",
#        fill = "Subtransect") +
#   geom_pointrange(aes(ymin = Count - se, 
#                       ymax = Count + se),
#                   size = 0.75,
#                   linetype = "solid"
#                   # ,
#                   # position = position_jitterdodge(dodge.width = .5)
#                                                   ) +
#   geom_smooth(
#               method = lm,
#               se = F,
#               size = 1,
#               alpha = 0.15) +
#   xlim(0, 40) +
#   ylim(0, 4) +
#   theme_bw() +
#   # scale_shape(solid = F)+
#   # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
#   theme(
#     legend.position = "none",
#     # legend.position = c(.99, .99),
#     # legend.justification = c("right", "top"),
#     # legend.box = 'horizontal',
#     # legend.box.just = "right",
#     # legend.margin = margin(5,5,5,5),
#     text = element_text(size=12),
#     axis.text = element_text(size=12),
#     panel.background = element_blank(),
#     axis.line = element_line(colour = "black")
#     # legend.key = element_rect(fill = NA)
#     ) +
#   scale_shape_manual(values = c(0,1),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) +
#   scale_color_manual(values = c("gray29", "gray9"),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) + 
#   scale_fill_manual(values = c("gray29", "gray9"),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) +
#   scale_linetype_manual(values = c('solid', 'dashed'),
#                         labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor"))  +
#   guides(linetype = FALSE) +
#   guides(shape = FALSE) +
#   guides(fill = FALSE) +
#   guides(color = FALSE) 
# # +
# #   labs(caption = "Error bars represent standard error")
# abun_transect
# 

```

####### Include points, ADD stats (as in paper)
```{r}
abun_transect <- ggplot(sum_abun %>%
                          filter(Transect != "Rural"),
                        aes(x = Dist_city,
                            y = Count,
                            color = Transect,
                           shape = Transect,
                            fill = Transect
                            )) +
  geom_point(aes(color = Transect,
                shape = Transect),
             size = 2) +
  geom_smooth(aes(fill = Transect,
                  color = Transect,
                  shape = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.15
              ) +
  scale_shape(solid = FALSE) +
  scale_color_manual(labels = c("Urban: Non-Corridor",
                                "Urban: Corridor"),
                     values = c("mediumvioletred",
                                 "forestgreen"))+
  scale_fill_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c("mediumvioletred",
                               "forestgreen"))+
    scale_shape_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c(2,1))+
  labs(x = " ",
    # x = "Distance to Urban Center (km)",
       y = "Mean Pollinators per Plant",
       shape = "Subtransect",
       fill = "Subtransect",
       color = "Subtransect",
       ) +
    # xlim(0, 40) +
  ylim(0, 2.5) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    axis.title.x = element_blank(),
    legend.direction="horizontal",
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA),
    legend.key.size = unit(1.5, "line")) +
  
   # adding stats from ANOVA
          geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Distance: p = 0.719\n Subtransect: p = 0.998"),
                size = 4)
# 
# geom_text(size = 4.25, x=10, y=0.1,
#             label = "Distance: p = 0.719",
#             hjust = 0) +
#     geom_text(size = 4.25, x=10, y=0.02,
#             label = "Subtransect: p = 0.998",
#             hjust = 0) 

abun_transect

```

###### Urb_score
####### Include points, no stats (not included in paper)
```{r}
abun_transect.u <- ggplot(sum_abun %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = Count,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Urbanization Score",
       y = "Mean Pollinators \n Observed per Plant",
       shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_pointrange(aes(ymin = Count - se, 
                      ymax = Count + se),
                  size = 0.5,
                  linetype = "solid"
                  # ,
                  # position = position_jitterdodge(dodge.width = .5)
                                                  ) +
  geom_smooth(
              method = lm,
              se = F,
              size = 1,
              alpha = 0.15) +
  xlim(4, -2) +
  ylim(0, 4) +
  theme_bw() +
  # scale_shape(solid = F)+
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("gray29", "gray9"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("gray29", "gray9"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) 
# +
#   labs(caption = "Error bars represent standard error")
abun_transect.u


```

####### Include points, add stats (as in paper)
```{r}

abun_transect.u <- ggplot(sum_abun %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = Count,
                            color = Transect,
                            fill = Transect,
                            shape = Transect)) +
  labs(x = "Urbanization Score",
       y = "Mean Pollinators per Plant",
       shape = "Subtransect",
       fill = "Subtransect",
       color = "Subtransect"       ) +
  geom_point(aes(color = Transect,
                shape = Transect),
             size = 2) +
  geom_smooth(aes(fill = Transect,
                  color = Transect,
                  shape = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.15
              ) +
  scale_shape(solid = FALSE) +
  scale_color_manual(labels = c("Urban: Non-Corridor",
                                "Urban: Corridor"),
                     values = c("mediumvioletred",
                                 "forestgreen"))+
  scale_fill_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c("mediumvioletred",
                               "forestgreen"))+
    scale_shape_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c(2,1))+
  
  xlim(4, -2) +
  ylim(0, 2.5) +
  theme(legend.position = c(.99, .99),
        legend.justification = c("right", "top"),
        legend.box = 'horizontal',
        legend.box.just = "right",
        legend.margin = margin(5,5,5,5),
        text = element_text(size=14),
        # axis.title.x = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        legend.key = element_rect(fill = NA),
        legend.key.size = unit(2, "line") )  +
  # adding stats from ANOVA
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Urb. Score: p = 0.844\n Subtransect: p = 0.988"),
                size = 4)

abun_transect.u
```

##### Abundance of 4 most populous families
```{r}
#### wrapped regressions per family vs dist city ctr ####
ggplot(diversity %>%
         filter(Family == c('Apidae',
                            'Cantharidae',
                            'Halictidae',
                            'Megachilidae')),
       aes(x = Dist_city,
           y = Count,
           colour = Family)) +
  labs(x = "Distance to Urban Center (km)",
       y = "Individuals Observed by Family per plant") +
  geom_point(aes( color = Family,
                  shape = Family),
                  size = 2) +
  geom_smooth(aes(color = Family), method = lm, alpha=0.15,  se = F) +
  xlim(0, 70) +
  ylim(0,6) +
  facet_wrap(~Family) +
  theme(
    # legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA) 
    ) +
  theme_bw()
  ggsave(here::here("Figures_Tables/Q3_Regressions_Pollinators/Supplement", "4_most_populous_families.png"),
         width = 14, height = 8, units = "cm")


####### regressions of each family's most common morphospecies vs dist city ctr #######
# ggplot(diversity %>%
#          filter(Morphospecies_Code == c( 'MS_06', 'MS_14' , 'MS_02', 'MS_21')),
#        aes(x = Dist_city, y = Count, colour = Morphospecies)) +
#   labs(x = "Distance to city center (km)", y = "Individuals Observed") +
#   geom_point(aes( color = Morphospecies)) +
#   scale_shape(solid = F)+
#   geom_smooth(aes(color = Morphospecies), method = lm, alpha=0.15,  se = T) +
#   facet_grid(~Family + Morphospecies,
#              labeller = label_context) +
#   theme(legend.position = "none") +
#   ylim(0, 4) +
#   xlim(0, 70)
  
  
  
###### Bombus abundance re: dist city ctr #######
#   ggplot(subset(diversity, Genus %in% 'Bombus'), aes(x = Dist_city, y = Count)) +
#   labs(x = "Distance to city center (km)", y = "Bombus Individuals Observed (per population)") +
#   geom_point() +
#   scale_shape(solid = F)+
#   geom_smooth( method = lm, alpha=0.15,  se = T) +
#   labs()
#   
# # Only 3 data points, so not very interesting/reliable.
#   
# 
# ###### Monarch abundance re: dist city ctr #######
#   ggplot(subset(diversity, Genus %in% 'Danaus'), aes(x = Dist_city, y = Count)) +
#   labs(x = "Distance to city center (km)", y = "Monarchs Observed (per population)") +
#   geom_point() +
#   scale_shape(solid = F)+
#   geom_smooth( method = lm, alpha=0.15,  se = T) +
#   labs()
# # Only 4 data points, so not very interesting/reliable.
  
  
###### Honeybee abundance re: dist city ctr #######
  ggplot(diversity %>%
           filter(Morphospecies == 'Apis mellifera (Large)'),
         aes(x = Dist_city,
             y = Count)) +
  labs(x = "Distance to Urban Center (km)",
       y = "Mean Honeybees Observed per Plant") +
  geom_point() +
  scale_shape(solid = F)+
  geom_smooth( method = lm, alpha=0.15,  se = F, color = "black") +
  xlim(0, 70) +
  ylim(0,6) +
  theme_bw()

ggsave(here::here("Figures_Tables/Q3_Regressions_Pollinators/Supplement", "Honeybees_per_plant.png"),
         width = 10, height = 8, units = "cm")
```

#### Diversity
##### Gradient
###### City_dist
####### Include points, no stats (not included in paper)
```{r}
# diversity_simpson <- ggplot(sum_diversity,
#                aes(x = Dist_city,
#                    y = simpson^2)) +
#   geom_point(color = "black",
#                   size = 2) +
#     scale_shape(solid = F)+
#   geom_smooth(method = lm,
#               se = T,
#               size = 1,
#               alpha = 0.3,
#               color = "black") +
#   labs(x = " ",
#     # x = "Distance to Urban Center (km)",
#        y = expression("Simpson's Diversity Index "^2)) +
#   xlim(0,70) +
#   ylim(0, 1) +
#   theme_bw() +
#   # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
#   theme(
#     legend.position = c(.99, .99),
#     legend.justification = c("right", "top"),
#     legend.box = 'horizontal',
#     legend.box.just = "right",
#     legend.margin = margin(5,5,5,5),
#     text = element_text(size=12),
#     axis.text = element_text(size=12),
#     panel.background = element_blank(),
#     axis.line = element_line(colour = "black"),
#     legend.key = element_rect(fill = NA)
#     ) 
# # +
# #   labs(caption = "Error bars represent standard error")
# diversity_simpson
```

####### Include points, ADD stats (as in paper)
```{r}
diversity_simpson <- ggplot(sum_diversity,
               aes(x = Dist_city,
                   y = simpson^2)) +
  geom_point(
             size = 2,
             color = "#00BFC4",
             shape = 1) +
  geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.15,
              color = "#00BFC4",
              fill = "#00BFC4") +
  xlim(0,70) +
  ylim(0, 0.8) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  labs(x = " ",
    # x = "Distance to Urban Center (km)",
       y = expression("Simpson's Diversity Index "^2)) +
  # adding stats from ANOVA
          geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Distance: p = 0.204"),
                size = 4)
# geom_text(size = 4.25, x=10, y=0.02, label = "Distance: p = 0.204", hjust = 0) 
diversity_simpson
```

###### Urb_score
####### Include points, no stats (not as in paper)
```{r}
diversity_simpson.u <- ggplot(sum_diversity,
               aes(x = Urb_score,
                   y = simpson^2)) +
  geom_point(color = "black",
                  size = 2) +
    scale_shape(solid = F)+
  geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.3,
              color = "black") +
  labs(x = "Urbanization Score",
       y = expression("Simpson's Diversity Index "^2)) +
  xlim(4, -4) +
  ylim(0, 1) +
  theme_bw() +
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) 
# +
#   labs(caption = "Error bars represent standard error")
diversity_simpson.u
```

####### Include points, ADD stats (as in paper)
```{r}
diversity_simpson.u <- ggplot(sum_diversity,
               aes(x = Urb_score,
                   y = simpson^2)) +
 geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.15,
              color = "#00BFC4",
              fill = "#00BFC4")  +
  geom_point(
             size = 2,
             color = "#00BFC4",
             shape = 1) +
  xlim(4, -4) +
  scale_y_continuous(limits = c(0, 0.8)) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    # axis.title.x = element_blank(),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  labs(x = "Urbanization Score",
       y = expression("Simpson's Diversity Index "^2)) +
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Urb. Score: p = 0.042"),
                size = 4)

diversity_simpson.u
```

##### Transects
###### City_dist
####### Include points, no stats (not included in paper)
```{r}
# diversity_simpson_transect <- ggplot(sum_diversity %>%
#                           filter(Transect != "Rural"),
#                         aes(x = Dist_city,
#                             y = simpson^3,
#                             color = Transect,
#                             shape = Transect,
#                             fill = Transect,
#                             linetype = Transect)) +
#   labs(x = " ",
#        y = expression("Simpson's Diversity Index "^3),
#        shape = "Subtransect",
#        linetype = "Subtransect",
#        color = "Subtransect",
#        fill = "Subtransect") +
#   geom_point(aes(color = Transect,
#                             shape = Transect,
#                             fill = Transect),
#                   size = 2.5) +
#   geom_smooth(aes(color = Transect),
#               method = lm,
#               se = T,
#               size = 1,
#               alpha = 0.3) +
#   xlim(0, 40) +
#   ylim(0, 1) +
#   theme_bw() +
#   # scale_shape(solid = F)+
#   theme(
#     legend.position = c(.99, .99),
#     legend.justification = c("right", "top"),
#     legend.box = 'horizontal',
#     legend.box.just = "right",
#     legend.margin = margin(5,5,5,5),
#     text = element_text(size=12),
#     axis.text = element_text(size=12),
#     panel.background = element_blank(),
#     axis.line = element_line(colour = "black"),
#     legend.key = element_rect(fill = NA)
#     ) +
#   scale_shape_manual(values = c(0,1),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) +
#   scale_color_manual(values = c("dark green", "slateblue4"),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) + 
#   scale_fill_manual(values = c("dark green", "slateblue4"),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) +
#   scale_linetype_manual(values = c('solid', 'dashed'),
#                         labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) 
# # +
# #   labs(caption = "Error bars represent standard error")
# diversity_simpson_transect
```

####### Include points, ADD stats (as in paper)
```{r}
diversity_simpson_transect <- ggplot(sum_diversity %>%
                          filter(Transect != "Rural"),
                        aes(x = Dist_city,
                            y = simpson^3 ,
                            color = Transect,
                           shape = Transect,
                            fill = Transect
                            )) +
  geom_point(aes(color = Transect,
                shape = Transect),
             size = 2) +
  geom_smooth(aes(fill = Transect,
                  color = Transect,
                  shape = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.15
              ) +
  scale_shape(solid = FALSE) +
  scale_color_manual(labels = c("Urban: Non-Corridor",
                                "Urban: Corridor"),
                     values = c("mediumvioletred",
                                 "forestgreen"))+
  scale_fill_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c("mediumvioletred",
                               "forestgreen"))+
    scale_shape_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c(2,1))+
  # xlim(0, 40) +
   labs(x = " ",
       y = expression("Simpson's Diversity Index "^3),
       shape = "Subtransect",
       fill = "Subtransect",
       color = "Subtransect",
       ) +
  ylim(0, 0.7) +
  theme(
    # legend.position = "none",
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    axis.title.x = element_blank(),
    legend.direction="horizontal",
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA),
    legend.key.size = unit(1.5, "line")) +

  # adding stats from ANOVA
          geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Distance: p = 0.316\n Subtransect: p = 0.009\n D x S: p = 0.135"),
                size = 4)

  # geom_text(size = 4.25, x=16, y=0.5,
  #           label = "Distance: p = 0.316",
  #           hjust = 0) +
  #   geom_text(size = 4.25, x=16, y=0.47,
  #           label = "Subtransect: p = 0.009",
  #           hjust = 0) +
  #   geom_text(size = 4.25, x=16, y=0.44,
  #           label = "D x S: p = 0.135",
  #           hjust = 0) 

diversity_simpson_transect
```

###### Urb_score
####### Include points, no stats (not included in paper)
```{r}
diversity_simpson_transect.u <- ggplot(sum_diversity %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = simpson^3,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Urbanization Score",
       y = expression("Simpson's Diversity Index "^3),
       shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_point(aes(color = Transect,
                            shape = Transect,
                            fill = Transect),
                  size = 2) +
  geom_smooth(aes(color = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.3) +
  xlim(4, -2) +
  ylim(0, 1) +
  theme_bw() +
  # scale_shape(solid = F)+
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) 
# +
#   labs(caption = "Error bars represent standard error")
diversity_simpson_transect.u
```

####### Include points, ADD stats (as in paper)
```{r}
diversity_simpson_transect.u <- ggplot(sum_diversity %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = simpson^3,
                            color = Transect,
                            fill = Transect,
                            shape = Transect)) +
  labs(x = "Urbanization Score",
       y = expression("Simpson's Diversity Index "^3),
       shape = "Subtransect",
       fill = "Subtransect",
       color = "Subtransect"       ) +
  geom_point(aes(color = Transect,
                shape = Transect),
             size = 2) +
  geom_smooth(aes(fill = Transect,
                  color = Transect,
                  shape = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.15
              ) +
  scale_shape(solid = FALSE) +
  scale_color_manual(labels = c("Urban: Non-Corridor",
                                "Urban: Corridor"),
                     values = c("mediumvioletred",
                                 "forestgreen"))+
  scale_fill_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c("mediumvioletred",
                               "forestgreen"))+
    scale_shape_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c(2,1))+
  
  xlim(4, -2) +
  ylim(0, 0.8) +
  theme(legend.position = c(.99, .99),
        legend.justification = c("right", "top"),
        legend.box = 'horizontal',
        legend.box.just = "right",
        legend.margin = margin(5,5,5,5),
        text = element_text(size=14),
        # axis.title.x = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        legend.key = element_rect(fill = NA),
        legend.key.size = unit(2, "line") )  +
  # adding stats from ANOVA
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Urb. Score: p = 0.132\n Subtransect: p = 0.029"),
                size = 4)

diversity_simpson_transect.u
```

#### Richness
##### Gradient
###### City_dist
####### Include points, without stats (as NOT paper)
```{r}
# rich <- ggplot(sum_richness,
#                aes(x = Dist_city,
#                    y = Menhinicks_index)) +
#   geom_point(color = "black",
#                   size = 2) +
#     scale_shape(solid = F)+
#   geom_smooth(method = lm,
#               se = T,
#               size = 1,
#               alpha = 0.3,
#               color = "black") +
#   labs(x = "Distance to Urban Center (km)",
#        y = "Menhinick's Species Richness") +
#   xlim(0,70) +
#   ylim(0, 4) +
#   theme_bw() +
#   theme(
#     legend.position = c(.99, .99),
#     legend.justification = c("right", "top"),
#     legend.box = 'horizontal',
#     legend.box.just = "right",
#     legend.margin = margin(5,5,5,5),
#     text = element_text(size=12),
#     axis.text = element_text(size=12),
#     panel.background = element_blank(),
#     axis.line = element_line(colour = "black"),
#     legend.key = element_rect(fill = NA)
#     ) 
# # +
# #   labs(caption = "Error bars represent standard error")
# rich
```


####### Include points, ADD stats (as in paper)
```{r}
rich <- ggplot(sum_richness,
               aes(x = Dist_city,
                   y = Menhinicks_index)) +
  geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.15,
              color = "#00BFC4",
              fill = "#00BFC4")  +
    geom_point(
             size = 2,
             color = "#00BFC4",
             shape = 1) +
  xlim(0,70) +
  ylim(0, 4.5) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  labs(x = "Distance to Urban Center (km)",
       y = "Menhinick's Species Richness") +
  # adding stats from ANOVA
          geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Distance: p = 0.013"),
                size = 4)
# geom_text(size = 4.25, x=10, y=0.15, label = "Distance: p = 0.013", hjust = 0) 
rich
```

###### Urb_score
####### Include points, without stats (as NOT paper)
```{r}
rich.u <- ggplot(sum_richness,
               aes(x = Urb_score,
                   y = Menhinicks_index)) +
  geom_point(color = "black",
                  size = 2) +
  geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.3,
              color = "black") +
  labs(x = "Urbanization Score",
       y = "Menhinick's \n Species Richness") +
  xlim(4, -4) +
  ylim(0, 4) +
  theme_bw() +
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) 
# +
#   labs(caption = "Error bars represent standard error")
rich.u
```

####### Include points, ADD stats (as in paper)
```{r}
rich.u <- ggplot(sum_richness,
               aes(x = Urb_score,
                   y = Menhinicks_index)) +
 geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.15,
              color = "#00BFC4",
              fill = "#00BFC4")  +
  geom_point(
             size = 2,
             color = "#00BFC4",
             shape = 1) +
  xlim(4, -4) +
  scale_y_continuous(limits = c(0, 4.5)) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    # axis.title.x = element_blank(),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  labs(x = "Urbanization Score",
       y = "Menhinick's Species Richness") +
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Urb. Score: p = 0.003"),
                size = 4)

rich.u
```

##### Transects
###### City_dist
####### Include points, without stats (as NOT paper)
```{r}
# rich_transect <- ggplot(sum_richness %>%
#                           filter(Transect != "Rural"),
#                         aes(x = Dist_city,
#                             y = Menhinicks_index,
#                             color = Transect,
#                             shape = Transect,
#                             fill = Transect,
#                             linetype = Transect)) +
#   labs(x = "Distance to Urban Center (km)",
#        y = "Menhinick's Species Richness",
#        shape = "Subtransect",
#        linetype = "Subtransect",
#        color = "Subtransect",
#        fill = "Subtransect") +
#   geom_point(aes(color = Transect,
#                             shape = Transect,
#                             fill = Transect),
#                   size = 2.5) +
#   geom_smooth(aes(color = Transect),
#               method = lm,
#               se = T,
#               size = 1,
#               alpha = 0.3) +
#   xlim(0, 40) +
#   ylim(0, 4)+
#   theme_bw() +
#   # scale_shape(solid = F)+
#   theme(
#     legend.position = c(.99, .99),
#     legend.justification = c("right", "top"),
#     legend.box = 'horizontal',
#     legend.box.just = "right",
#     legend.margin = margin(5,5,5,5),
#     text = element_text(size=12),
#     axis.text = element_text(size=12),
#     panel.background = element_blank(),
#     axis.line = element_line(colour = "black"),
#     legend.key = element_rect(fill = NA)
#     ) +
#   scale_shape_manual(values = c(0,1),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) +
#   scale_color_manual(values = c("dark green", "slateblue4"),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) + 
#   scale_fill_manual(values = c("dark green", "slateblue4"),
#                      labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) +
#   scale_linetype_manual(values = c('solid', 'dashed'),
#                         labels = c("Urban: Non-Corridor",
#                                 "Urban: Corridor")) 
# # +
# #   labs(caption = "Error bars represent standard error")
# rich_transect
```

####### Include points, ADD stats (as in paper)
```{r}
rich_transect <- ggplot(sum_richness %>%
                          filter(Transect != "Rural"),
                        aes(x = Dist_city,
                            y = Menhinicks_index,
                          color = Transect,
                           shape = Transect,
                            fill = Transect
                            )) +
  geom_point(aes(color = Transect,
                shape = Transect),
             size = 2) +
  geom_smooth(aes(fill = Transect,
                  color = Transect,
                  shape = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.15
              ) +
  scale_shape(solid = FALSE) +
  scale_color_manual(labels = c("Urban: Non-Corridor",
                                "Urban: Corridor"),
                     values = c("mediumvioletred",
                                 "forestgreen"))+
  scale_fill_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c("mediumvioletred",
                               "forestgreen"))+
    scale_shape_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c(2,1))+
  labs(x = "Distance to Urban Center (km)",
       y = "Menhinick's Species Richness",
       shape = "Subtransect",
       fill = "Subtransect",
       color = "Subtransect"       ) +
  # xlim(0, 40) +
  ylim(0, 5)+
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    # axis.title.x = element_blank(),
    legend.direction="horizontal",
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA),
    legend.key.size = unit(1.5, "line")) +
  # adding stats from ANOVA
          geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Distance: p = 0.284\n Subtransect: p = 0.03 "),
                size = 4)

# geom_text(size = 4.25, x=10, y=0.3,
#             label = "Distance: p = 0.284",
#             hjust = 0) +
#     geom_text(size = 4.25, x=10, y=0.1,
#             label = "Subtransect: p = 0.03",
#             hjust = 0) 

rich_transect
```


###### Urb_score
####### Include points, no stats (not included in paper)
```{r}
rich_transect.u <- ggplot(sum_richness %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = Menhinicks_index,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Urbanization Score",
       y = "Menhinick's \n Species Richness",
       shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_point(aes(color = Transect,
                            shape = Transect,
                            fill = Transect),
                  size = 2) +
  geom_smooth(aes(color = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.3) +
  xlim(4, -2) +
  ylim(0, 4) +
  theme_bw() +
  # scale_shape(solid = F)+
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) 
# +
#   labs(caption = "Error bars represent standard error")
rich_transect.u
```

####### Include points, add stats (as in paper)
```{r}
rich_transect.u <- ggplot(sum_richness %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = Menhinicks_index,
                            color = Transect,
                            fill = Transect,
                            shape = Transect)) +
  labs(x = "Urbanization Score",
       y = "Menhinick's Species Richness",
       shape = "Subtransect",
       fill = "Subtransect",
       color = "Subtransect"       ) +
  geom_point(aes(color = Transect,
                shape = Transect),
             size = 2) +
  geom_smooth(aes(fill = Transect,
                  color = Transect,
                  shape = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.15
              ) +
  scale_shape(solid = FALSE) +
  scale_color_manual(labels = c("Urban: Non-Corridor",
                                "Urban: Corridor"),
                     values = c("mediumvioletred",
                                 "forestgreen"))+
  scale_fill_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c("mediumvioletred",
                               "forestgreen"))+
    scale_shape_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c(2,1))+
  
  xlim(4, -2) +
  ylim(0, 5) +
  theme(legend.position = c(.99, .99),
        legend.justification = c("right", "top"),
        legend.box = 'horizontal',
        legend.box.just = "right",
        legend.margin = margin(5,5,5,5),
        text = element_text(size=14),
        # axis.title.x = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        legend.key = element_rect(fill = NA),
        legend.key.size = unit(2, "line") )  +
  # adding stats from ANOVA
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Urb. Score: p = 0.19\n Subtransect: p = 0.081"),
                size = 4)

rich_transect.u
```


#### Composite figure (main text)
##### Gradient
```{r}

library(ggpubr) # 'ggplot2' Based Publication Ready Plots

# Q3_regressions <- ggarrange(abun,
#                             diversity_simpson,
#                             rich,
#                             abun.u,
#                             diversity_simpson.u,
#                             rich.u,
#                             ncol = 3, nrow = 2, align = "v",
#                             labels = list("A", "B", "C", "D", "E", "F"),
#                             font.label = (size =16),
#                             common.legend = FALSE)
# Q3_regressions


# REORDERED FOR MAIN TEXT (AND WITHOUT URB SCORE PANELS)
Q3_regressions <- ggarrange(abun,
                            rich,
                            diversity_simpson,
                            ncol = 3, nrow = 1, align = "h",
                            labels = list("A", "B", "C"),
                            font.label = (size =16),
                            common.legend = FALSE
                            )
Q3_regressions

# annotate_figure(Q3_regressions, bottom = text_grob("Distance to Urban Center (km)", size=14))

dev.copy2pdf(file="~/R_Projects/chapter_one/Figures_Tables/Q3_Regressions_Pollinators/Pollinator_regressions_POINTS.pdf", width = 11, height = 3.75)
```

##### Transects
```{r}
library(ggpubr) # 'ggplot2' Based Publication Ready Plots 

# Q3_regressions.transects <- ggarrange(abun_transect,
#                             diversity_simpson_transect,
#                             rich_transect,
#                             abun_transect.u,
#                             diversity_simpson_transect.u,
#                             rich_transect.u,
#                             ncol = 3, nrow = 2, align = "h",
#                             labels = list("A", "B", "C", "D", "E", "F"),
#                             font.label = (size =16),
#                             common.legend = T)
# Q3_regressions.transects

# REORDERED FOR MAIN TEXT (AND WITHOUT URB SCORE PANELS)
Q3_regressions.transects <- ggarrange(abun_transect,
                                      rich_transect,
                                      diversity_simpson_transect,
                            ncol = 3, nrow = 1, align = "h",
                            labels = list("A", "B", "C"),
                            font.label = (size =14),
                            common.legend = T) %T>%
  plot()


# annotate_figure(Q3_regressions, bottom = text_grob("Distance to Urban Center (km)", size=14))

dev.copy2pdf(file="~/R_Projects/chapter_one/Figures_Tables/Q4_Regressions_Pollinators/Pollinator_regressions_transects_POINTS.pdf", width = 12, height = 4.2)

```

#### Supplement
##### Evenness
###### Gradient
####### City_dist
######## Include points, without stats (as NOT in paper)
```{r}
even <- ggplot(sum_evenness,
               aes(x = Dist_city,
                   y = simpson_equit)) +
  geom_point(color = "black",
                  size = 2) +
    scale_shape(solid = F)+
  geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.3,
              color = "black") +
  labs(x = "Distance to Urban Center (km)",
       y = "Simpson's Evenness") +
  xlim(0,70) +
  # ylim(0, 4) +
  theme_bw() +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) 
# +
#   labs(caption = "Error bars represent standard error")
even
```

######## Include points, ADD stats (as in paper)
```{r}
even <- ggplot(sum_evenness,
               aes(x = Dist_city,
                   y = simpson_equit)) +
 geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.15,
              color = "#00BFC4",
              fill = "#00BFC4")  +
    geom_point(
             size = 2,
             color = "#00BFC4",
             shape = 1) +
  xlim(0,70) +
  scale_y_continuous(limits = c(0, 1.1),
                     breaks = c(0,0.25,0.5,0.75,1)) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    # axis.title.x = element_blank(),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  labs(x = "Distance to Urban Center (km)",
       y = "Simpson's Evenness") +
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Distance: p = 0.389"),
                size = 4)

even
```


####### Urb_score
```{r}
even.u <- ggplot(sum_evenness,
               aes(x = Urb_score,
                   y = simpson_equit)) +
 geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.15,
              color = "#00BFC4",
              fill = "#00BFC4")  +
    geom_point(
             size = 2,
             color = "#00BFC4",
             shape = 1) +
  xlim(4, -4) +
  scale_y_continuous(limits = c(0, 1.1),
                     breaks = c(0, 0.25, 0.5, 0.75, 1)) +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    # axis.title.x = element_blank(),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  labs(x = "Urbanization Score",
       y = "Simpson's Evenness") +
  geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Urb. Score: p = 0.15"),
                size = 4)
even.u

```

###### Transects
####### City_dist
######## Include points, no stats (not included in paper)
```{r}
even_transect <- ggplot(sum_evenness %>%
                          filter(Transect != "Rural"),
                        aes(x = Dist_city,
                            y = simpson_equit^3,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Distance to Urban Center (km)",
       y = expression("Simpson's Evenness "^3),
       shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_point(aes(color = Transect,
                            shape = Transect,
                            fill = Transect),
                  size = 2) +
  geom_smooth(aes(color = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.3) +
  xlim(0, 40) +
  theme_bw() +
  # ylim(0, 4) +
  # scale_shape(solid = F)+
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) 
# +
#   labs(caption = "Error bars represent standard error")
even_transect
```

######## Include points, ADD stats (as in paper)
```{r}
even_transect <- ggplot(sum_evenness %>%
                          filter(Transect != "Rural"),
                        aes(x = Dist_city,
                            y = simpson_equit^3,
                            color = Transect,
                            fill = Transect,
                            shape = Transect)) +
  labs(x = "Distance to Urban Center (km)",
       y = expression("Simpson's Evenness "^3),
       shape = "Subtransect",
       fill = "Subtransect",
       color = "Subtransect"       ) +
  geom_point(aes(color = Transect,
                shape = Transect),
             size = 2) +
  geom_smooth(aes(fill = Transect,
                  color = Transect,
                  shape = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.15
              ) +
  scale_shape(solid = FALSE) +
  scale_color_manual(labels = c("Urban: Non-Corridor",
                                "Urban: Corridor"),
                     values = c("mediumvioletred",
                                 "forestgreen"))+
  scale_fill_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c("mediumvioletred",
                               "forestgreen"))+
    scale_shape_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c(2,1))+
  ylim(0, 1.5) +
  xlim(0, 35) +
 theme(legend.position = c(.99, .99),
        legend.justification = c("right", "top"),
        legend.box = 'horizontal',
        legend.box.just = "right",
        legend.margin = margin(5,5,5,5),
        text = element_text(size=14),
        # axis.title.x = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        legend.key = element_rect(fill = NA),
        legend.key.size = unit(2, "line") )  +
  # adding stats from ANOVA
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Distance: p = 0.316\n Subtransect: p = 0.009\n Distance x Subtransect: p = 0.135"),
                size = 4)


even_transect
```


####### Urb_score
######## Include points, no stats (not included in paper)
```{r}
even_transect.u <- ggplot(sum_evenness %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = simpson_equit^3,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Urbanization Score",
       y = expression("Simpson's Evenness "^3),
       shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_point(aes(color = Transect,
                            shape = Transect,
                            fill = Transect),
                  size = 2) +
  geom_smooth(aes(color = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.3) +
  xlim(4, -2) +
  theme_bw() +
  # ylim(0, 4) +
  # scale_shape(solid = F)+
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=12),
    axis.text = element_text(size=12),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) 
# +
#   labs(caption = "Error bars represent standard error")
even_transect.u
```

######## Include points, ADD stats (as in paper)
```{r}
even_transect.u <- ggplot(sum_evenness %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = simpson_equit^3,
                            color = Transect,
                            fill = Transect,
                            shape = Transect)) +
  labs(x = "Urbanization Score",
       y = expression("Simpson's Evenness "^3),
       shape = "Subtransect",
       fill = "Subtransect",
       color = "Subtransect"       ) +
  geom_point(aes(color = Transect,
                shape = Transect),
             size = 2) +
  geom_smooth(aes(fill = Transect,
                  color = Transect,
                  shape = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.15
              ) +
  scale_shape(solid = FALSE) +
  scale_color_manual(labels = c("Urban: Non-Corridor",
                                "Urban: Corridor"),
                     values = c("mediumvioletred",
                                 "forestgreen"))+
  scale_fill_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c("mediumvioletred",
                               "forestgreen"))+
    scale_shape_manual(labels = c("Urban: Non-Corridor",
                               "Urban: Corridor"),
                    values = c(2,1))+
  
  xlim(4, -2) +
  ylim(0, 1.5) +
  theme(legend.position = c(.99, .99),
        legend.justification = c("right", "top"),
        legend.box = 'horizontal',
        legend.box.just = "right",
        legend.margin = margin(5,5,5,5),
        text = element_text(size=14),
        # axis.title.x = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        legend.key = element_rect(fill = NA),
        legend.key.size = unit(2, "line") )  +
  # adding stats from ANOVA
        geom_text_npc(aes(npcx = 0, npcy = 1,
                    label = " Urb. Score: p = 0.132\n Subtransect: p = 0.029"),
                size = 4)

even_transect.u
```


##### Composite Figure
###### Gradient & transect figs together
```{r}

library(ggpubr) # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots
Q3_regressions.evenness <- ggarrange(even,
                            even_transect,
                            even.u,
                            even_transect.u,
                            ncol = 2, nrow = 2, align = "h",
                            labels = list("A", "B", "C", "D"),
                            font.label = (size =16),
                            common.legend = TRUE)
Q3_regressions.evenness

# annotate_figure(Q3_regressions, bottom = text_grob("Distance to Urban Center (km)", size=14))

dev.copy2pdf(file="~/R_Projects/chapter_one/Figures_Tables/Q3_Regressions_Pollinators/Supplement/Pollinator_regressions_Evenness.pdf", width = 12, height = 7)
```
###### Gradient & transect figs separate
####### Gradient figs
```{r}

##### ADD OTHER URB_SCORE VARS TOO
ggarrange(even,
          abun.u,
          diversity_simpson.u,
          rich.u,
          even.u,
          ncol = 3, nrow = 2, align = "hv",
          labels = list("A", "B", "C", "D", "E"),
          font.label = (size =16),
          common.legend = TRUE)

dev.copy2pdf(file="~/R_Projects/chapter_one/Figures_Tables/Q3_Regressions_Pollinators/Supplement/Pollinator_regressions_urbscore_gradientfigs_points.pdf", width = 12, height = 7.5)
```

####### Transect figs
```{r}

##### ADD OTHER URB_SCORE VARS TOO
ggarrange(even_transect,
          abun_transect.u,
          diversity_simpson_transect.u,
          rich_transect.u,
          even_transect.u,
          ncol = 3, nrow = 2, align = "hv",
          labels = list("A", "B", "C", "D", "E"),
          font.label = (size =14),
          common.legend = TRUE)

dev.copy2pdf(file="~/R_Projects/chapter_one/Figures_Tables/Q4_Regressions_Pollinators/Supplement/Pollinator_regressions_urbscore_transects_points.pdf", width = 12, height = 7.5)
```


##### Abundance & Diversity without Honeybees
###### Abundance
####### Gradient
######## City_dist
```{r}
abun.nohoney <- ggplot(sum_abun.nohoney,
               aes(x = Dist_city,
                   y = Count)) +
  geom_pointrange(aes(ymin = Count - se, 
                      ymax = Count + se),
                  size = 0.5,
                   color = "black"
                  # ,
                  # position = position_jitterdodge(dodge.width = .5)
                                                  ) +
    scale_shape(solid = F)+
  geom_smooth(method = lm,
              se = F,
              size = 1,
              alpha = 0.15,
              color = "black") +
  labs(x = "Distance to Urban Center (km)",
       y = "Mean Pollinators Observed per Plant: \n Honeybees Excluded") +
  xlim(0,70) +
  ylim(0, 6) +
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  theme_bw()
# +
#   labs(caption = "Error bars represent standard error")
abun.nohoney
```

######## Urb_score
```{r}
abun.u.nohoney <- ggplot(sum_abun.nohoney,
               aes(x = Urb_score,
                   y = Count)) +
  geom_pointrange(aes(ymin = Count - se, 
                      ymax = Count + se),
                  size = 0.5,
                   color = "black"
                  # ,
                  # position = position_jitterdodge(dodge.width = .5)
                                                  ) +
    scale_shape(solid = F)+
  geom_smooth(method = lm,
              se = F,
              size = 1,
              alpha = 0.15,
              color = "black") +
  labs(x = "Urbanization Score",
       y = "Mean Pollinators Observed per Plant: \n Honeybees Excluded") +
  xlim(4, -4) +
  ylim(0, 6) +
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  theme_bw()
# +
#   labs(caption = "Error bars represent standard error")
abun.u.nohoney
```

####### Transects
######## City_dist
```{r}
abun_transect.nohoney <- ggplot(sum_abun.nohoney %>%
                          filter(Transect != "Rural"),
                        aes(x = Dist_city,
                            y = Count,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Distance to Urban Center (km)",
       y = "Mean Pollinators Observed per Plant: \n Honeybees Excluded",
       shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_pointrange(aes(ymin = Count - se, 
                      ymax = Count + se),
                  size = 0.5,
                  linetype = "solid"
                  # ,
                  # position = position_jitterdodge(dodge.width = .5)
                                                  ) +
  geom_smooth(
              method = lm,
              se = F,
              size = 1,
              alpha = 0.15) +
  xlim(0, 40) +
  ylim(0, 4) +
  # scale_shape(solid = F)+
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("gray29", "gray9"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("gray29", "gray9"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  theme_bw()
# +
#   labs(caption = "Error bars represent standard error")
abun_transect.nohoney
```

######## Urb_score
```{r}
abun_transect.u.nohoney <- ggplot(sum_abun.nohoney %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = Count,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Urbanization Score",
       y = "Mean Pollinators Observed per Plant: \n Honeybees Excluded",
       shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_pointrange(aes(ymin = Count - se, 
                      ymax = Count + se),
                  size = 0.5,
                  linetype = "solid"
                  # ,
                  # position = position_jitterdodge(dodge.width = .5)
                                                  ) +
  geom_smooth(
              method = lm,
              se = F,
              size = 1,
              alpha = 0.15) +
  xlim(4, -2) +
  ylim(0, 4) +
  # scale_shape(solid = F)+
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("gray29", "gray9"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("gray29", "gray9"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  theme_bw()
# +
#   labs(caption = "Error bars represent standard error")
abun_transect.u.nohoney

```

###### Diversity
####### Gradient
######## City_dist
```{r}
diversity_simpson.nohoney <- ggplot(sum_diversity.nohoney,
               aes(x = Dist_city,
                   y = simpson^2)) +
  geom_point(color = "black",
                  size = 2) +
    scale_shape(solid = F)+
  geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.3,
              color = "black") +
  labs(x = "Distance to Urban Center (km)",
       y = expression(atop(paste("Simpson's Diversity Index "^2, ":"), paste("Honeybees Excluded")))) +
  xlim(0,70) +
  ylim(0, 1) +
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  theme_bw()
# +
#   labs(caption = "Error bars represent standard error")
diversity_simpson.nohoney
```

######## Urb_score
```{r}
diversity_simpson.u.nohoney <- ggplot(sum_diversity.nohoney,
               aes(x = Urb_score,
                   y = simpson^2)) +
  geom_point(color = "black",
                  size = 2) +
    scale_shape(solid = F)+
  geom_smooth(method = lm,
              se = T,
              size = 1,
              alpha = 0.3,
              color = "black") +
  labs(x = "Urbanization Score",
       y = expression(atop(paste("Simpson's Diversity Index "^2, ":"), paste("Honeybees Excluded")))) +
  xlim(4, -4) +
  ylim(0, 1) +
  # labs(title = 'Pollinator Abundance Along Urban-Rural Gradient') +
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  theme_bw()
# +
#   labs(caption = "Error bars represent standard error")
diversity_simpson.u.nohoney
```

####### Transects
######## City_dist
```{r}
diversity_simpson_transect.nohoney <- ggplot(sum_diversity.nohoney %>%
                          filter(Transect != "Rural"),
                        aes(x = Dist_city,
                            y = simpson^3,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Distance to Urban Center (km)",
       y = expression(atop(paste("Simpson's Diversity Index "^3, ":"), paste("Honeybees Excluded"))),
  shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_point(aes(color = Transect,
                            shape = Transect,
                            fill = Transect),
                  size = 2) +
  geom_smooth(aes(color = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.3) +
  xlim(0, 40) +
  ylim(0, 1) +
  # scale_shape(solid = F)+
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  theme_bw()
# +
#   labs(caption = "Error bars represent standard error")
diversity_simpson_transect.nohoney
```

######## Urb_score
```{r}
diversity_simpson_transect.u.nohoney <- ggplot(sum_diversity.nohoney %>%
                          filter(Transect != "Rural"),
                        aes(x = Urb_score,
                            y = simpson^3,
                            color = Transect,
                            shape = Transect,
                            fill = Transect,
                            linetype = Transect)) +
  labs(x = "Urbanization Score",
       y = expression(atop(paste("Simpson's Diversity Index "^3, ":"), paste("Honeybees Excluded"))),
       shape = "Subtransect",
       linetype = "Subtransect",
       color = "Subtransect",
       fill = "Subtransect") +
  geom_point(aes(color = Transect,
                            shape = Transect,
                            fill = Transect),
                  size = 2) +
  geom_smooth(aes(color = Transect),
              method = lm,
              se = T,
              size = 1,
              alpha = 0.3) +
  xlim(4, -2) +
  ylim(0, 1) +
  # scale_shape(solid = F)+
  theme(
    legend.position = c(.99, .99),
    legend.justification = c("right", "top"),
    legend.box = 'horizontal',
    legend.box.just = "right",
    legend.margin = margin(5,5,5,5),
    text = element_text(size=14),
    panel.background = element_blank(),
    axis.line = element_line(colour = "black"),
    legend.key = element_rect(fill = NA)
    ) +
  scale_shape_manual(values = c(0,1),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_color_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) + 
  scale_fill_manual(values = c("dark green", "slateblue4"),
                     labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  scale_linetype_manual(values = c('solid', 'dashed'),
                        labels = c("Urban: Non-Corridor",
                                "Urban: Corridor")) +
  theme_bw()
# +
#   labs(caption = "Error bars represent standard error")
diversity_simpson_transect.u.nohoney
```

###### Composite figure (main text)
####### Gradient
```{r}

library(ggpubr) # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots
Q3_regressions.nohoney <- ggarrange(abun.nohoney,
                            diversity_simpson.nohoney,
                            abun.u.nohoney,
                            diversity_simpson.u.nohoney,
                            ncol = 2, nrow = 2, align = "v",
                            labels = list("A", "B", "C", "D"),
                            font.label = (size =16),
                            common.legend = FALSE)
Q3_regressions.nohoney

# annotate_figure(Q3_regressions.nohoney, bottom = text_grob("Distance to Urban Center (km)", size=14))

dev.copy2pdf(file="~/R_Projects/chapter_one/Figures_Tables/Q3_Regressions_Pollinators/Supplement/Pollinator_regressions_nohoneybees.pdf", width = 12, height = 7)
```

####### Transects
```{r}
library(ggpubr) # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots # 'ggplot2' Based Publication Ready Plots
Q3_regressions.transects.nohoney <- ggarrange(abun_transect.nohoney,
                            diversity_simpson_transect.nohoney,
                            abun_transect.u.nohoney,
                            diversity_simpson_transect.u.nohoney,
                            ncol = 2, nrow = 2, align = "h",
                            labels = list("A", "B", "C", "D"),
                            font.label = (size =16),
                            common.legend = TRUE)
Q3_regressions.transects.nohoney

# annotate_figure(Q3_regressions.nohoney, bottom = text_grob("Distance to Urban Center (km)", size=14))

dev.copy2pdf(file="~/R_Projects/chapter_one/Figures_Tables/Q4_Regressions_Pollinators/Supplement/Pollinator_regressions_transects_nohoneybees.pdf", width = 12, height = 7)
```

